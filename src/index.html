<!DOCTYPE html>
<html lang="en">

<head>
  <script src="https://unpkg.com/lucide@latest"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>K's GPO Fishing Macro</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div id="updateBanner" style="display: none;">
    <div style="display: flex; align-items: center; justify-content: center; gap: 16px; flex-wrap: wrap;">
      <span style="font-weight: 600; font-size: 14px;">
        New version available: <strong id="newVersionText">v0.0.0</strong>
      </span>
      <button onclick="downloadUpdate()"
        style="padding: 8px 24px; background: white; color: #00cc88; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 13px;">
        Download Update
      </button>
      <button onclick="dismissBanner()"
        style="padding: 8px 20px; background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.4); border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 13px;">
        Dismiss
      </button>
    </div>
  </div>

  <div class="container">
    <div class="header">
      <div class="brand">
        <div class="logo"><span>K</span></div>
        <div class="title-group">
          <h1>K's GPO Fishing Macro</h1>
          <div style="display: flex; align-items: center; gap: 8px;">
            <div class="version">Version 1.2.8</div>
            <div style="color: var(--accent-tertiary); opacity: 0.7; font-size: 0.75em;">Pre-Release</div>
          </div>
        </div>
      </div>
      <div style="display: flex; align-items: center; gap: 12px;">
        <div class="rdp-indicator" id="rdpIndicator">
          <div class="rdp-dot"></div>
          <span id="rdpText">Local Session</span>
        </div>
        <div class="status-badge">
          <div class="status-dot" id="statusDot"></div>
          <span class="status-text" id="statusText">Inactive</span>
        </div>
      </div>
    </div>

    <div class="main-content">
      <div class="sidebar">
        <div class="nav-item active" data-view="home">
          <i data-lucide="home"></i>
          <span>Dashboard</span>
        </div>
        <div class="nav-item" data-view="controls">
          <i data-lucide="sliders"></i>
          <span>Control Center</span>
        </div>
        <div class="nav-item" data-view="locations">
          <i data-lucide="map-pin"></i>
          <span>Locations</span>
        </div>
        <div class="nav-item" data-view="fishing-modes">
          <i data-lucide="fish"></i>
          <span>Fishing Modes</span>
        </div>
        <div class="nav-item" data-view="automation">
          <i data-lucide="workflow"></i>
          <span>Automation</span>
        </div>
        <div class="nav-item" data-view="tuning">
          <i data-lucide="settings"></i>
          <span>Tuning</span>
        </div>
        <div class="nav-item" data-view="timing">
          <i data-lucide="clock"></i>
          <span>Timing</span>
        </div>
        <div class="nav-item" data-view="logging">
          <i data-lucide="file-text"></i>
          <span>Logging</span>
        </div>
        <div class="nav-item" data-view="settings">
          <i data-lucide="cog"></i>
          <span>Settings</span>
        </div>
      </div>

      <div class="content-area">

        <div class="view active" id="home">
          <div class="hero-section">
            <h1 class="hero-title">Welcome to K's GPO Fishing Macro</h1>
            <p class="hero-subtitle">
              An advanced automation tool for Grand Piece Online fishing. Configure your settings, set up locations, and
              start fishing efficiently!
            </p>
            <div class="quick-links">
              <a href="https://github.com/K3nD4rk-Code-Developer/Grand-Piece-Online-Fishing" target="_blank"
                class="quick-link">
                <span class="quick-link-icon"><i class="fab fa-github"></i></span>
                GitHub Repository
              </a>
              <a href="https://discord.com/invite/vKVBbyfHTD" target="_blank" class="quick-link">
                <span class="quick-link-icon"><i class="fab fa-discord"></i></span>
                Discord Community
              </a>
              <a href="https://youtu.be/Ynnp3DKCJgM" target="_blank" class="quick-link">
                <span class="quick-link-icon"><i class="fab fa-youtube"></i></span>
                Video Tutorial
              </a>
            </div>
          </div>

          <div class="tips-section">
            <div class="tips-title">Essential Setup Tips</div>
            <div class="tip-item">
              <div class="tip-text"><strong>Run As Admin:</strong> Run the app as Admin to give it more CPU resources.
              </div>
            </div>
            <div class="tip-item">
              <div class="tip-text"><strong>FPS Cap:</strong> Set your in-game FPS to your monitor's refresh rate to
                prevent missed catches.</div>
            </div>
            <div class="tip-item">
              <div class="tip-text"><strong>Camera Zoom:</strong> Keep your camera zoomed enough to see the bar closely
                enough but not too much it's above other UI's.</div>
            </div>
            <div class="tip-item">
              <div class="tip-text"><strong>Cartoonize Your Gameplay:</strong> Set your graphics to 1, turn on fast mode
                in your GPO settings, and turn off shadows.</div>
            </div>
          </div>

          <div class="slideshow-card">
            <div class="card-header" style="margin-bottom:16px;">Visual Guides</div>
            <div class="slideshow-tabs" id="slideshowTabs"></div>
            <div class="slideshow-viewport" id="slideshowViewport">
              <button class="slide-nav prev" id="slidePrev">&#8249;</button>
              <button class="slide-nav next" id="slideNext">&#8250;</button>
            </div>
            <div class="slide-dots" id="slideDots"></div>
          </div>

          <div class="card">
            <div class="card-header">Troubleshooting</div>
            <div class="tip-item">
              <div class="tip-text"><strong>Macro won't start:</strong> Ensure that your water point and selected rods
                are correct.</div>
            </div>
            <div class="tip-item">
              <div class="tip-text"><strong>Missing fish games:</strong> Adjust the scan area so it fully covers the
                fishing bar (and a bit beyond). Make sure Roblox is running at your monitor's refresh rate, the bar
                doesn't overlap with other UI, and run app as admin.</div>
            </div>
            <div class="tip-item">
              <div class="tip-text"><strong>Not casting:</strong> Verify Water Point is set correctly. Check that
                fishing rod is in the correct inventory slot.</div>
            </div>
            <div class="tip-item">
              <div class="tip-text"><strong>Auto-buy failing:</strong> Reconfigure bait shop points. Increase Pre-Cast
                delays in Timing → Purchase Interaction Timing.</div>
            </div>
            <div class="tip-item">
              <div class="tip-text"><strong>Actions too fast/slow:</strong> Adjust timing delays in the Timing tab. Add
                0.1–0.2s to delays if actions are being skipped.</div>
            </div>
          </div>
        </div>

        <div class="view" id="controls">
          <div class="card">
            <div class="card-header">Keybinds</div>
            <div class="control-group">
              <span class="control-label">Start/Stop Macro</span>
              <div class="control-input">
                <div class="hotkey-badge" id="hotkey-start">F1</div>
                <button class="btn btn-sm" onclick="sendToPython('rebind_hotkey', 'start_stop')">Rebind</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Exit Application</span>
              <div class="control-input">
                <div class="hotkey-badge" id="hotkey-exit">F3</div>
                <button class="btn btn-sm" onclick="sendToPython('rebind_hotkey', 'exit')">Rebind</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Configure Scan Area</span>
              <div class="control-input">
                <button class="btn btn-sm" onclick="sendToPython('open_area_selector', '')">Open Area Selector</button>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Inventory Slots</div>
            <div class="control-group">
              <span class="control-label">Fishing Rod Slot</span>
              <div class="control-input">
                <select class="select" id="rodHotkey" onchange="validateAndSetRodSlot(this.value)">
                  <option selected>1</option>
                  <option>2</option>
                  <option>3</option>
                  <option>4</option>
                  <option>5</option>
                  <option>6</option>
                  <option>7</option>
                  <option>8</option>
                  <option>9</option>
                  <option>0</option>
                </select>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Secondary Item Slot</span>
              <div class="control-input">
                <select class="select" id="anythingElseHotkey" onchange="validateAndSetSecondarySlot(this.value)">
                  <option>1</option>
                  <option selected>2</option>
                  <option>3</option>
                  <option>4</option>
                  <option>5</option>
                  <option>6</option>
                  <option>7</option>
                  <option>8</option>
                  <option>9</option>
                  <option>0</option>
                </select>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Devil Fruit Slots</span>
              <div class="control-input" style="margin-left: 20px;">
                <div id="devilFruitSlotSelector" style="display: flex; gap: 8px; flex-wrap: wrap;"></div>
              </div>
            </div>
            <div class="help-hint">Select multiple slots to check for devil fruits</div>
          </div>

          <div class="card">
            <div class="card-header">Application Settings</div>
            <div class="control-group">
              <span class="control-label">Keep Window on Top</span>
              <div class="control-input">
                <div class="toggle-switch" id="alwaysOnTopToggle" onclick="toggleSetting('alwaysOnTop')"></div>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Display Statistics Overlay</span>
              <div class="control-input">
                <div class="toggle-switch" id="debugOverlayToggle" onclick="toggleSetting('debugOverlay')"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="view" id="locations">
          <div class="card">
            <div class="card-header">Primary Fishing Location</div>
            <div class="control-group">
              <span class="control-label">Water Target Point</span>
              <div class="control-input">
                <span class="point-indicator unset" id="waterPointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_water_point', '')">Configure</button>
              </div>
            </div>
            <div class="help-hint">Click the location in water where you want to cast your fishing line</div>
          </div>

          <div class="card">
            <div class="card-header">Bait Locations</div>
            <div class="control-group">
              <span class="control-label">Top Bait Point</span>
              <div class="control-input">
                <span class="point-indicator unset" id="baitPointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_bait_point', '')">Configure</button>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Bait Shop Interaction Points</div>
            <div class="control-group">
              <span class="control-label">Left Dialog Option</span>
              <div class="control-input">
                <span class="point-indicator unset" id="leftPointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_left_point', '')">Configure</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Middle Dialog Option</span>
              <div class="control-input">
                <span class="point-indicator unset" id="middlePointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_middle_point', '')">Configure</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Right Dialog Option</span>
              <div class="control-input">
                <span class="point-indicator unset" id="rightPointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_right_point', '')">Configure</button>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Crafting Interface Points</div>
            <div class="control-group">
              <span class="control-label">Left Dialog Option</span>
              <div class="control-input">
                <span class="point-indicator unset" id="craftLeftPointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_craft_left_point', '')">Configure</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Middle Dialog Option</span>
              <div class="control-input">
                <span class="point-indicator unset" id="craftMiddlePointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_craft_middle_point', '')">Configure</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Add Ingredient</span>
              <div class="control-input">
                <span class="point-indicator unset" id="addRecipePointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_add_recipe_point', '')">Configure</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Top Recipe Slot</span>
              <div class="control-input">
                <span class="point-indicator unset" id="topRecipePointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_top_recipe_point', '')">Configure</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Click Craft Confirm</span>
              <div class="control-input">
                <span class="point-indicator unset" id="craftButtonPointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_craft_button_point', '')">Configure</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Menu Close</span>
              <div class="control-input">
                <span class="point-indicator unset" id="closeMenuPointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_close_menu_point', '')">Configure</button>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              Crafting Recipes
              <button class="btn btn-sm" onclick="addNewRecipe()" style="float: right;">+ Add Recipe</button>
            </div>
            <div id="RecipesContainer"></div>
          </div>

          <div class="card">
            <div class="card-header">Devil Fruit Locations</div>
            <div class="control-group">
              <span class="control-label">Devil Fruit Store</span>
              <div class="control-input">
                <span class="point-indicator unset" id="storeFruitPointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_store_fruit_point', '')">Configure</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Devil Fruit Backpack</span>
              <div class="control-input">
                <span class="point-indicator unset" id="devilFruitLocationPointStatus">Not Configured</span>
                <button class="btn btn-sm"
                  onclick="sendToPython('set_devil_fruit_location_point', '')">Configure</button>
              </div>
            </div>
            <div class="help-hint">This feature is still a work in progress, don't mind it. Used for storing inside of
              backpack instead of drop</div>
          </div>

          <div class="card">
            <div class="card-header">OCR Configuration</div>
            <div class="control-group">
              <span class="control-label">Devil Fruit Detection Area</span>
              <div class="control-input">
                <button class="btn btn-sm" onclick="sendToPython('open_ocr_area_selector', '')">Configure OCR
                  Region</button>
              </div>
            </div>
            <div class="help-hint">Set the screen area where devil fruit notifications appear for OCR detection</div>
          </div>
        </div>

        <div class="view" id="fishing-modes">
          <div class="card">
            <div class="card-header">RDP Session Detection</div>
            <div class="control-group">
              <span class="control-label">Current Session Type</span>
              <div class="control-input">
                <span class="rdp-indicator" id="sessionTypeIndicator">
                  <div class="rdp-dot"></div>
                  <span id="sessionTypeText">Detecting...</span>
                </span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Auto-Detect RDP Sessions</span>
              <div class="control-input">
                <div class="toggle-switch active" id="autoDetectRdpToggle" onclick="toggleSetting('autoDetectRdp')">
                </div>
              </div>
            </div>
            <div class="help-hint">Automatically detect when running in Remote Desktop and adjust behavior</div>
          </div>

          <div class="card">
            <div class="card-header">Megalodon Mode</div>
            <div class="control-group">
              <span class="control-label">Enable Megalodon Sound Recognition</span>
              <div class="control-input">
                <div class="toggle-switch" id="megalodonSoundToggle" onclick="checkAndToggleMegalodon()"></div>
              </div>
            </div>
            <div class="requirement-warning" id="megalodonAudioWarning">
              <strong>⚠️ No Loopback Audio Device Found:</strong><br>
              Megalodon sound detection requires a WASAPI loopback device (e.g. "Stereo Mix" or a virtual audio cable).<br>
              Enable <strong>Stereo Mix</strong> in Windows Sound settings → Recording tab, or install a virtual audio driver.
            </div>
            <div class="help-hint">Listens for Megalodon roar sound and only continues fishing if detected</div>
            <div class="control-group">
              <span class="control-label">Sound Sensitivity</span>
              <div class="control-input">
                <input type="number" class="input" id="soundSensitivity" value="0.1" step="0.1" min="0" max="1"
                  onchange="sendToPython('set_sound_sensitivity', this.value)">
                <span class="unit">threshold</span>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Multi-Device Sync</div>
            <div class="control-group">
              <span class="control-label">Enable Device Synchronization</span>
              <div class="control-input">
                <div class="toggle-switch" id="enableDeviceSyncToggle"
                  onclick="toggleExpandable('enableDeviceSync', 'deviceSyncExpand')"></div>
              </div>
            </div>
            <div class="expandable-section" id="deviceSyncExpand">
              <div class="control-group">
                <span class="control-label">Sync Settings Across Devices</span>
                <div class="control-input">
                  <div class="toggle-switch active" id="syncSettingsToggle" onclick="toggleSetting('syncSettings')">
                  </div>
                </div>
              </div>
              <div class="control-group">
                <span class="control-label">Sync Statistics</span>
                <div class="control-input">
                  <div class="toggle-switch active" id="syncStatsToggle" onclick="toggleSetting('syncStats')"></div>
                </div>
              </div>
              <div class="control-group">
                <span class="control-label">Share Fish Count Across Devices</span>
                <div class="control-input">
                  <div class="toggle-switch" id="sharesFishCountToggle" onclick="toggleSetting('shareFishCount')"></div>
                </div>
              </div>
              <div class="control-group">
                <span class="control-label">Sync Interval</span>
                <div class="control-input">
                  <input type="number" class="input" id="syncInterval" value="5" step="1" min="1" max="60"
                    onchange="sendToPython('set_sync_interval', this.value)">
                  <span class="unit">seconds</span>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Client Identification</div>
            <div class="control-group">
              <span class="control-label">Device Name</span>
              <div class="control-input">
                <input type="text" class="input input-wide" id="deviceName" placeholder="My Gaming PC"
                  onchange="sendToPython('set_device_name', this.value)">
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Client ID</span>
              <div class="control-input">
                <span class="hotkey-badge" id="clientIdDisplay"
                  style="font-size: 9px; letter-spacing: 0;">Loading...</span>
                <button class="btn btn-sm btn-secondary" onclick="regenerateClientId()">Regenerate</button>
              </div>
            </div>
            <div class="help-hint">Each device has a unique ID for tracking and synchronization</div>
          </div>

          <div class="card">
            <div class="card-header">Active Sessions</div>
            <div id="activeSessionsContainer">
              <div style="text-align:center;padding:20px;color:#6b7a92;">
                Loading sessions...
              </div>
            </div>
          </div>
        </div>

        <div class="view" id="automation">
          <div class="card">
            <div class="card-header">Auto Select Bait</div>
            <div class="control-group">
              <span class="control-label">Enable Auto Select Top Bait</span>
              <div class="control-input">
                <div class="toggle-switch" id="autoSelectBaitToggle" onclick="toggleSetting('autoSelectBait')"></div>
              </div>
            </div>
            <div class="requirement-warning" id="autoSelectBaitWarning">
              <strong>Missing Requirements:</strong><br>
              You need to configure the Top Bait Point first.<br>
              Go to <a onclick="navigateToLocations()">Locations → Bait Locations</a>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Auto Purchase Bait</div>
            <div class="control-group">
              <span class="control-label">Enable Auto Buy Common Bait</span>
              <div class="control-input">
                <div class="toggle-switch" id="autoBuyBaitToggle"
                  onclick="toggleExpandable('autoBuyBait', 'autoBuyExpand')"></div>
              </div>
            </div>
            <div class="requirement-warning" id="autoBuyBaitWarning">
              <strong>⚠️ Missing Requirements:</strong><br>
              You need to configure all Bait Shop points first.<br>
              Go to <a onclick="navigateToLocations()">Locations → Bait Shop Interaction Points</a>
            </div>
            <div class="expandable-section" id="autoBuyExpand">
              <div class="control-group">
                <span class="control-label">Purchase Frequency</span>
                <div class="control-input">
                  <input type="number" class="input" id="loopsPerPurchase" value="100" step="1"
                    onchange="sendToPython('set_loops_per_purchase', this.value)">
                  <span class="unit">loops</span>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Auto Craft Bait</div>
            <div class="control-group">
              <span class="control-label">Enable Auto Craft</span>
              <div class="control-input">
                <div class="toggle-switch" id="autoCraftBaitToggle"
                  onclick="toggleExpandable('autoCraftBait', 'autoCraftExpand')"></div>
              </div>
            </div>
            <div class="requirement-warning" id="autoCraftBaitWarning">
              <strong>Missing Requirements:</strong><br>
              You need to configure all crafting points and recipes first.<br>
              Go to <a onclick="navigateToLocations()">Locations → Crafting Interface Points</a>
            </div>
            <div class="expandable-section" id="autoCraftExpand">
              <div class="control-group">
                <span class="control-label">Fish Caught Before Craft</span>
                <div class="control-input">
                  <input type="number" class="input" id="fishCountPerCraft" value="50" step="1" min="1"
                    onchange="sendToPython('set_fish_count_per_craft', this.value)">
                  <span class="unit">fish</span>
                </div>
              </div>
              <div class="control-group">
                <span class="control-label">Movement Duration</span>
                <div class="control-input">
                  <input type="number" class="input" id="moveDuration" value="0" step="0.25"
                    onchange="sendToPython('set_move_duration', this.value)">
                  <span class="unit">seconds</span>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Auto Store Devil Fruit</div>
            <div class="control-group">
              <span class="control-label">Enable Auto Storage</span>
              <div class="control-input">
                <div class="toggle-switch" id="autoStoreFruitToggle"
                  onclick="toggleExpandable('autoStoreFruit', 'autoStoreExpand')"></div>
              </div>
            </div>
            <div class="requirement-warning" id="autoStoreFruitWarning">
              <strong>Missing Requirements:</strong><br>
              You need to configure the Devil Fruit Store location first.<br>
              Go to <a onclick="navigateToLocations()">Locations → Devil Fruit Locations</a>
            </div>
            <div class="expandable-section" id="autoStoreExpand">
              <div class="control-group">
                <span class="control-label">Store to Backpack (vs Drop)</span>
                <div class="control-input">
                  <div class="toggle-switch disabled" id="storeToBackpackToggle"
                    style="opacity: 0.5; cursor: not-allowed; pointer-events: none;"></div>
                  <span style="color: #6b7a92; font-size: 10px; font-style: italic; margin-left: 8px;">Coming
                    Soon</span>
                </div>
              </div>
              <div class="control-group">
                <span class="control-label">Storage Frequency</span>
                <div class="control-input">
                  <input type="number" class="input" id="loopsPerStore" value="1" step="1" min="1"
                    onchange="sendToPython('set_loops_per_store', this.value)">
                  <span class="unit">loops</span>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Devil Fruit Spawn Detection</div>
            <div class="control-group">
              <span class="control-label">Enable Spawn Detection</span>
              <div class="control-input">
                <div class="toggle-switch" id="enableSpawnDetectionToggle"
                  onclick="toggleExpandable('enableSpawnDetection', 'spawnDetectionExpand')"></div>
              </div>
            </div>
            <div class="requirement-warning" id="enableSpawnDetectionWarning">
              <strong>⚠️ Missing Requirements:</strong><br>
              You need to configure the OCR Detection Area first.<br>
              Go to <a onclick="navigateToLocations()">Locations → OCR Configuration</a>
            </div>
            <div class="expandable-section" id="spawnDetectionExpand">
              <div class="control-group">
                <span class="control-label">Scan Interval</span>
                <div class="control-input">
                  <input type="number" class="input" id="spawnScanInterval" value="5.0" step="0.5" min="0.5" max="10"
                    onchange="sendToPython('set_spawn_scan_interval', this.value)">
                  <span class="unit">seconds</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="view" id="tuning">
          <div class="card">
            <div class="card-header">PD Controller Settings</div>
            <div class="control-group">
              <span class="control-label">Proportional Gain (Follow Strength)</span>
              <div class="control-input">
                <input type="number" class="input" id="kp" value="0.9" step="0.1"
                  onchange="sendToPython('set_kp', this.value)">
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Derivative Gain (Damping)</span>
              <div class="control-input">
                <input type="number" class="input" id="kd" value="0.3" step="0.1"
                  onchange="sendToPython('set_kd', this.value)">
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Maximum Correction Clamp</span>
              <div class="control-input">
                <input type="number" class="input" id="pdClamp" value="1.0" step="0.1"
                  onchange="sendToPython('set_pd_clamp', this.value)">
              </div>
            </div>
            <div class="help-hint">PD control maintains alignment between the fishing bar and target</div>
          </div>

          <div class="card">
            <div class="card-header">Advanced PD Parameters</div>
            <div class="control-group">
              <span class="control-label">Approaching Damping Factor</span>
              <div class="control-input">
                <input type="number" class="input" id="pdApproaching" value="2.0" step="0.1"
                  onchange="sendToPython('set_pd_approaching', this.value)">
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Chasing Damping Factor</span>
              <div class="control-input">
                <input type="number" class="input" id="pdChasing" value="0.5" step="0.1"
                  onchange="sendToPython('set_pd_chasing', this.value)">
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Gap Tolerance Multiplier</span>
              <div class="control-input">
                <input type="number" class="input" id="gapTolerance" value="2.0" step="0.1"
                  onchange="sendToPython('set_gap_tolerance', this.value)">
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Casting Configuration</div>
            <div class="control-group">
              <span class="control-label">Cast Hold Duration</span>
              <div class="control-input">
                <input type="number" class="input" id="castHold" value="1.0" step="0.1"
                  onchange="sendToPython('set_cast_hold', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Recast Timeout</span>
              <div class="control-input">
                <input type="number" class="input" id="recastTimeout" value="30.0" step="1.0"
                  onchange="sendToPython('set_recast_timeout', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Anti-Detection Thresholds</div>
            <div class="control-group">
              <span class="control-label">Black Screen Detection</span>
              <div class="control-input">
                <input type="number" class="input" id="blackThreshold" value="0.5" step="0.05"
                  onchange="sendToPython('set_black_threshold', this.value)">
                <span class="unit">%</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Key Spam Prevention Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="spamDelay" value="0.25" step="0.05"
                  onchange="sendToPython('set_spam_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
          </div>
        </div>

        <div class="view" id="timing">
          <div class="card">
            <div class="card-header">Core Timing Settings</div>
            <div class="control-group">
              <span class="control-label">Fish Completion Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="fishEndDelay" value="2.0" step="0.1"
                  onchange="sendToPython('set_fish_end_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">State Resend Interval</span>
              <div class="control-input">
                <input type="number" class="input" id="stateResend" value="0.5" step="0.05"
                  onchange="sendToPython('set_state_resend', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Scan Loop Frequency</span>
              <div class="control-input">
                <input type="number" class="input" id="scanDelay" value="0.1" step="0.01"
                  onchange="sendToPython('set_scan_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Window Focus Timing</div>
            <div class="control-group">
              <span class="control-label">Initial Focus Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="focusDelay" value="0.2" step="0.1"
                  onchange="sendToPython('set_focus_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Post-Focus Stabilization</span>
              <div class="control-input">
                <input type="number" class="input" id="postFocusDelay" value="1.0" step="0.1"
                  onchange="sendToPython('set_post_focus_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Inventory Selection Timing</div>
            <div class="control-group">
              <span class="control-label">Rod Selection Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="rodDelay" value="0.5" step="0.1"
                  onchange="sendToPython('set_rod_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Bait Selection Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="baitDelay" value="0.5" step="0.1"
                  onchange="sendToPython('set_bait_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Cursor Movement Humanization</span>
              <div class="control-input">
                <input type="number" class="input" id="cursorDelay" value="0.05" step="0.01"
                  onchange="sendToPython('set_cursor_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Purchase Interaction Timing</div>
            <div class="control-group">
              <span class="control-label">Interaction Key Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="preCastE" value="3.0" step="0.1"
                  onchange="sendToPython('set_precast_e_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Click Confirmation Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="preCastClick" value="3.0" step="0.1"
                  onchange="sendToPython('set_precast_click_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Typing Input Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="preCastType" value="3.0" step="0.1"
                  onchange="sendToPython('set_precast_type_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Humanization Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="antiDetect" value="0.05" step="0.01"
                  onchange="sendToPython('set_anti_detect_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Devil Fruit Storage Timing</div>
            <div class="control-group">
              <span class="control-label">Hotkey Press Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="fruitHotkey" value="1.0" step="0.1"
                  onchange="sendToPython('set_fruit_hotkey_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Click Interaction Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="fruitClick" value="2.0" step="0.1"
                  onchange="sendToPython('set_fruit_click_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Shift Key Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="fruitShift" value="0.5" step="0.1"
                  onchange="sendToPython('set_fruit_shift_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Backspace Input Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="fruitBackspace" value="1.5" step="0.1"
                  onchange="sendToPython('set_fruit_backspace_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Crafting Timing</div>
            <div class="control-group">
              <span class="control-label">Menu Open Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="craftMenuDelay" value="0.85" step="0.05"
                  onchange="sendToPython('set_craft_menu_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">UI Click Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="craftClickDelay" value="0.5" step="0.05"
                  onchange="sendToPython('set_craft_click_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Recipe Selection Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="craftRecipeDelay" value="0.5" step="0.05"
                  onchange="sendToPython('set_craft_recipe_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Add Recipe Button Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="craftAddDelay" value="0.5" step="0.05"
                  onchange="sendToPython('set_craft_add_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Top Recipe Slot Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="craftTopDelay" value="0.5" step="0.05"
                  onchange="sendToPython('set_craft_top_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Craft Button Click Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="craftButtonDelay" value="0.025" step="0.005"
                  onchange="sendToPython('set_craft_button_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Close Menu Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="craftCloseDelay" value="0.5" step="0.05"
                  onchange="sendToPython('set_craft_close_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="help-hint">Fine-tune delays between crafting actions to prevent errors</div>
          </div>
        </div>

        <div class="view" id="logging">
          <div class="card">
            <div class="card-header">Webhook Configuration</div>
            <div class="control-group">
              <span class="control-label">Discord Webhook URL</span>
              <div class="control-input">
                <input type="text" class="input input-wide" id="webhookUrl"
                  placeholder="https://discord.com/api/webhooks/..."
                  onchange="sendToPython('set_webhook_url', this.value)">
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Discord User ID (for pings)</span>
              <div class="control-input">
                <input type="text" class="input input-wide" id="discordUserId" placeholder="123456789012345678"
                  onchange="sendToPython('set_discord_user_id', this.value)">
              </div>
            </div>
            <div class="help-hint">Enter your Discord User ID - use toggles below to control which notifications ping
              you</div>
            <div class="control-group">
              <span class="control-label">Test Webhook</span>
              <div class="control-input">
                <button class="btn btn-sm" onclick="testWebhook()">Send Test Message</button>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Reporting Intervals</div>
            <div class="control-group">
              <span class="control-label">Stats Report Interval</span>
              <div class="control-input">
                <input type="number" class="input" id="periodicStatsInterval" value="5" step="1" min="1"
                  onchange="sendToPython('set_periodic_stats_interval', this.value)">
                <span class="unit">minutes</span>
              </div>
            </div>
            <div class="help-hint">How often to send periodic statistics reports to your webhook</div>
          </div>

          <div class="card">
            <div class="card-header">Notification Settings</div>
            <div class="control-group">
              <span class="control-label">Devil Fruit Stored</span>
              <div class="control-input">
                <div class="toggle-switch" id="logDevilFruitToggle"
                  onclick="toggleLoggingExpandable('logDevilFruitToggle', 'logDevilFruitExpand')"></div>
              </div>
            </div>
            <div class="expandable-section" id="logDevilFruitExpand">
              <div class="control-group">
                <span class="control-label">Enable Ping</span>
                <div class="control-input">
                  <div class="toggle-switch" id="pingDevilFruitToggle" onclick="toggleSetting('pingDevilFruit')"></div>
                </div>
              </div>
            </div>

            <div class="control-group">
              <span class="control-label">Devil Fruit Spawns</span>
              <div class="control-input">
                <div class="toggle-switch" id="logSpawnsToggle"
                  onclick="toggleLoggingExpandable('logSpawnsToggle', 'logSpawnsExpand')"></div>
              </div>
            </div>
            <div class="expandable-section" id="logSpawnsExpand">
              <div class="control-group">
                <span class="control-label">Enable Ping</span>
                <div class="control-input">
                  <div class="toggle-switch" id="pingSpawnsToggle" onclick="toggleSetting('pingSpawns')"></div>
                </div>
              </div>
            </div>

            <div class="control-group">
              <span class="control-label">Recast Timeouts</span>
              <div class="control-input">
                <div class="toggle-switch" id="logRecastTimeoutsToggle"
                  onclick="toggleLoggingExpandable('logRecastTimeoutsToggle', 'logRecastTimeoutsExpand')"></div>
              </div>
            </div>
            <div class="expandable-section" id="logRecastTimeoutsExpand">
              <div class="control-group">
                <span class="control-label">Enable Ping</span>
                <div class="control-input">
                  <div class="toggle-switch" id="pingRecastTimeoutsToggle"
                    onclick="toggleSetting('pingRecastTimeouts')"></div>
                </div>
              </div>
            </div>

            <div class="control-group">
              <span class="control-label">Periodic Statistics</span>
              <div class="control-input">
                <div class="toggle-switch" id="logPeriodicStatsToggle"
                  onclick="toggleLoggingExpandable('logPeriodicStatsToggle', 'logPeriodicStatsExpand')"></div>
              </div>
            </div>
            <div class="expandable-section" id="logPeriodicStatsExpand">
              <div class="control-group">
                <span class="control-label">Enable Ping</span>
                <div class="control-input">
                  <div class="toggle-switch" id="pingPeriodicStatsToggle" onclick="toggleSetting('pingPeriodicStats')">
                  </div>
                </div>
              </div>
            </div>

            <div class="control-group">
              <span class="control-label">General Updates</span>
              <div class="control-input">
                <div class="toggle-switch" id="logGeneralUpdatesToggle"
                  onclick="toggleLoggingExpandable('logGeneralUpdatesToggle', 'logGeneralUpdatesExpand')"></div>
              </div>
            </div>
            <div class="expandable-section" id="logGeneralUpdatesExpand">
              <div class="control-group">
                <span class="control-label">Enable Ping</span>
                <div class="control-input">
                  <div class="toggle-switch" id="pingGeneralUpdatesToggle"
                    onclick="toggleSetting('pingGeneralUpdates')"></div>
                </div>
              </div>
            </div>

            <div class="control-group">
              <span class="control-label">Macro Start/Stop</span>
              <div class="control-input">
                <div class="toggle-switch" id="logMacroStateToggle"
                  onclick="toggleLoggingExpandable('logMacroStateToggle', 'logMacroStateExpand')"></div>
              </div>
            </div>
            <div class="expandable-section" id="logMacroStateExpand">
              <div class="control-group">
                <span class="control-label">Enable Ping</span>
                <div class="control-input">
                  <div class="toggle-switch" id="pingMacroStateToggle" onclick="toggleSetting('pingMacroState')"></div>
                </div>
              </div>
            </div>

            <div class="control-group">
              <span class="control-label">Errors & Warnings</span>
              <div class="control-input">
                <div class="toggle-switch active" id="logErrorsToggle"
                  onclick="toggleLoggingExpandable('logErrorsToggle', 'logErrorsExpand')"></div>
              </div>
            </div>
            <div class="expandable-section" id="logErrorsExpand">
              <div class="control-group">
                <span class="control-label">Enable Ping</span>
                <div class="control-input">
                  <div class="toggle-switch" id="pingErrorsToggle" onclick="toggleSetting('pingErrors')"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="view" id="settings">
          <div class="card">
            <div class="card-header">Application Information</div>
            <div class="control-group">
              <span class="control-label">Version</span>
              <div class="control-input">
                <span class="hotkey-badge"
                  style="background: linear-gradient(135deg, rgba(0, 255, 170, 0.2), rgba(0, 204, 136, 0.15)); border-color: rgba(0, 255, 170, 0.4); color: var(--success);">1.2.8</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Build Hash</span>
              <div class="control-input">
                <span class="hotkey-badge"
                  style="font-size: 9px; letter-spacing: 0; background: rgba(22, 27, 38, 0.8);">06a1b16287acc78892d5dd2ff57f26e8</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Configuration File</span>
              <div class="control-input">
                <button class="btn btn-sm btn-secondary" onclick="sendToPython('open_config_folder', '')">Open Config
                  Folder</button>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Configuration Management</div>
            <div class="control-group">
              <span class="control-label">Export Settings to File</span>
              <div class="control-input">
                <button class="btn btn-sm" onclick="sendToPython('export_settings', '')">Export Settings</button>
              </div>
            </div>
            <div class="help-hint">Save your current configuration to a file</div>
            <div class="control-group">
              <span class="control-label">Import Settings from File</span>
              <div class="control-input">
                <button class="btn btn-sm" onclick="sendToPython('import_settings', '')">Import Settings</button>
              </div>
            </div>
            <div class="help-hint">Load configuration from a previously exported file</div>
            <div class="control-group">
              <span class="control-label">Reset to Default Settings</span>
              <div class="control-input">
                <button class="btn btn-sm btn-secondary" onclick="confirmResetSettings()">Reset Settings</button>
              </div>
            </div>
            <div class="help-hint">This will erase all your current settings and restore defaults</div>
          </div>

          <div class="card">
            <div class="card-header">Debug Tools</div>
            <div class="control-group">
              <span class="control-label">View Current Configuration</span>
              <div class="control-input">
                <button class="btn btn-sm" onclick="sendToPython('view_config', '')">View Config JSON</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Clear Cached Data</span>
              <div class="control-input">
                <button class="btn btn-sm btn-secondary" onclick="sendToPython('clear_cache', '')">Clear Cache</button>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <div id="disclaimerModal" class="modal-overlay">
    <div class="modal-container">
      <div class="modal-header">
        <div class="modal-icon">⚠️</div>
        <h2>Important Notice</h2>
      </div>
      <div class="modal-body">
        <div class="disclaimer-section">
          <h3>Free & Open Source Software</h3>
          <p>This macro is <strong>completely free</strong> and made for public use. It should <strong>never be bought
              or resold</strong> to anyone under any circumstances.</p>
        </div>
        <div class="disclaimer-section">
          <h3>Creator Attribution</h3>
          <p>Created by <strong class="creator-name">KenNumi</strong></p>
          <p class="credit-notice">If you reproduce, modify, or redistribute this software, you must give proper credit
            to the original creator.</p>
        </div>
        <div class="disclaimer-section warning-box">
          <p><strong>Warning:</strong> Anyone charging money for this software is scamming you. Please report such
            incidents and obtain the macro from official sources only.</p>
        </div>
      </div>
      <div class="modal-footer">
        <label class="checkbox-container">
          <input type="checkbox" id="dontShowAgain">
          <span class="checkbox-label">Don't show this again</span>
        </label>
        <button class="btn btn-primary" onclick="closeDisclaimer()">I Understand</button>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
</body>

</html>