<!DOCTYPE html>
<html lang="en">

<head>
  <script src="https://unpkg.com/lucide@latest"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>K's GPO Fishing Macro</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-primary: #0a0e1a;
      --bg-secondary: #0f1419;
      --bg-tertiary: #161b26;
      --bg-card: #1a2030;
      --accent-primary: #00d9ff;
      --accent-secondary: #0099ff;
      --accent-tertiary: #00ffcc;
      --text-primary: #e8f0ff;
      --text-secondary: #9badc7;
      --text-muted: #6b7a92;
      --border-subtle: rgba(0, 217, 255, 0.08);
      --border-accent: rgba(0, 217, 255, 0.25);
      --success: #00ffaa;
      --warning: #ffaa00;
      --danger: #ff4466;
      --glow-cyan: rgba(0, 217, 255, 0.3);
      --glow-blue: rgba(0, 153, 255, 0.3);
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(30px);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
        transform: scale(1);
      }

      50% {
        opacity: 0.6;
        transform: scale(0.95);
      }
    }

    @keyframes glow {

      0%,
      100% {
        box-shadow: 0 0 20px var(--glow-cyan), 0 0 40px var(--glow-blue);
      }

      50% {
        box-shadow: 0 0 30px var(--glow-cyan), 0 0 60px var(--glow-blue);
      }
    }

    @keyframes spin {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        max-height: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        max-height: 1000px;
        transform: translateY(0);
      }
    }

    @keyframes slideUp {
      from {
        transform: translateY(0);
        opacity: 1;
      }

      to {
        transform: translateY(-100%);
        opacity: 0;
      }
    }

    @keyframes float {

      0%,
      100% {
        transform: translateY(0px);
      }

      50% {
        transform: translateY(-10px);
      }
    }

    @keyframes shimmer {
      0% {
        background-position: -1000px 0;
      }

      100% {
        background-position: 1000px 0;
      }
    }

    @keyframes ripple {
      0% {
        transform: scale(0);
        opacity: 1;
      }

      100% {
        transform: scale(4);
        opacity: 0;
      }
    }

    @keyframes borderGlow {

      0%,
      100% {
        border-color: rgba(0, 217, 255, 0.3);
        box-shadow: 0 0 10px rgba(0, 217, 255, 0.2);
      }

      50% {
        border-color: rgba(0, 217, 255, 0.6);
        box-shadow: 0 0 20px rgba(0, 217, 255, 0.4);
      }
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      overflow: hidden;
      height: 100vh;
      line-height: 1.5;
      position: relative;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background:
        radial-gradient(circle at 20% 30%, rgba(0, 217, 255, 0.08) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(0, 153, 255, 0.06) 0%, transparent 50%),
        radial-gradient(circle at 50% 50%, rgba(0, 255, 204, 0.04) 0%, transparent 70%);
      pointer-events: none;
      animation: float 20s ease-in-out infinite;
    }

    .container {
      height: 100vh;
      display: grid;
      grid-template-rows: auto 1fr;
      position: relative;
      z-index: 1;
    }

    .header {
      background: linear-gradient(135deg, rgba(15, 20, 25, 0.95), rgba(26, 32, 48, 0.9));
      padding: 20px 28px;
      border-bottom: 1px solid var(--border-accent);
      backdrop-filter: blur(20px);
      position: relative;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
      animation: slideInLeft 0.5s ease-out;
    }

    .header::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--accent-primary), var(--accent-tertiary), transparent);
      opacity: 0.5;
      animation: shimmer 66s linear infinite;
      background-size: 1000px 100%;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .logo {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 900;
      font-size: 26px;
      color: white;
      box-shadow: 0 0 20px var(--glow-cyan), 0 0 40px var(--glow-blue);
      animation: glow 3s ease-in-out infinite;
      position: relative;
      overflow: hidden;
    }

    .logo::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      animation: shimmer 3s linear infinite;
    }

    .logo span {
      display: block;
      transform: translate(-0.5px, -1px);
      position: relative;
      z-index: 1;
    }

    .title-group h1 {
      font-size: 20px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-tertiary));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: -0.3px;
    }

    .version {
      font-size: 10px;
      font-weight: 600;
      color: var(--accent-primary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-top: 2px;
      opacity: 0.8;
    }

    .status-badge {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 18px;
      background: linear-gradient(135deg, rgba(26, 32, 48, 0.8), rgba(22, 27, 38, 0.8));
      border-radius: 25px;
      border: 1px solid var(--border-accent);
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      animation: borderGlow 3s ease-in-out infinite;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--danger);
      box-shadow: 0 0 15px rgba(255, 68, 102, 0.8);
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      position: relative;
    }

    .status-dot::before {
      content: '';
      position: absolute;
      inset: -5px;
      border-radius: 50%;
      border: 2px solid currentColor;
      opacity: 0;
    }

    .status-dot.active {
      background: var(--success);
      box-shadow: 0 0 15px rgba(0, 255, 170, 0.8);
    }

    .status-text {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
    }

    .main-content {
      display: grid;
      grid-template-columns: 220px 1fr;
      height: 100%;
      min-height: 0;
      overflow: hidden;
      position: relative;
      z-index: 1;
    }

    .sidebar {
      background: linear-gradient(180deg, rgba(15, 20, 25, 0.95), rgba(26, 32, 48, 0.9));
      border-right: 1px solid var(--border-accent);
      padding: 20px 0;
      overflow-y: auto;
      overflow-x: hidden;
      min-height: 0;
      animation: slideInLeft 0.6s ease-out;
      backdrop-filter: blur(10px);
    }

    .sidebar::-webkit-scrollbar {
      width: 4px;
    }

    .sidebar::-webkit-scrollbar-track {
      background: transparent;
    }

    .sidebar::-webkit-scrollbar-thumb {
      background: var(--border-accent);
      border-radius: 2px;
    }

    .nav-item {
      padding: 14px 20px;
      margin: 0 10px 6px 10px;
      cursor: pointer;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid transparent;
      position: relative;
      display: flex;
      align-items: center;
      gap: 12px;
      overflow: hidden;
    }

    .nav-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      background: var(--accent-primary);
      transform: scaleY(0);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 0 3px 3px 0;
    }

    .nav-item::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      opacity: 0;
      transition: opacity 0.3s ease;
      border-radius: 10px;
    }

    .nav-item i {
      width: 18px;
      height: 18px;
      flex-shrink: 0;
      position: relative;
      z-index: 1;
    }

    .nav-item svg {
      width: 18px;
      height: 18px;
      stroke-width: 2;
      position: relative;
      z-index: 1;
    }

    .nav-item span {
      position: relative;
      z-index: 1;
    }

    .nav-item:hover {
      color: var(--text-primary);
      background: rgba(0, 217, 255, 0.05);
      border-color: var(--border-subtle);
      transform: translateX(3px);
    }

    .nav-item.active {
      color: var(--accent-primary);
      background: rgba(0, 217, 255, 0.12);
      border-color: var(--border-accent);
      box-shadow: 0 0 15px rgba(0, 217, 255, 0.2);
    }

    .nav-item.active::before {
      transform: scaleY(1);
    }

    .nav-item.active::after {
      opacity: 0.05;
    }

    .content-area {
      overflow-y: auto;
      overflow-x: hidden;
      padding: 28px;
      min-height: 0;
      animation: fadeIn 0.6s ease-out;
      background: linear-gradient(180deg, rgba(10, 14, 26, 0) 0%, rgba(10, 14, 26, 0.3) 100%);
    }

    .content-area::-webkit-scrollbar {
      width: 6px;
    }

    .content-area::-webkit-scrollbar-track {
      background: transparent;
    }

    .content-area::-webkit-scrollbar-thumb {
      background: var(--border-accent);
      border-radius: 3px;
    }

    .view {
      display: none;
      animation: fadeIn 0.5s ease-out;
    }

    .view.active {
      display: block;
    }

    .card {
      background: linear-gradient(135deg, rgba(26, 32, 48, 0.6), rgba(22, 27, 38, 0.6));
      border: 1px solid var(--border-subtle);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      backdrop-filter: blur(20px);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      animation: slideInRight 0.5s ease-out;
      animation-fill-mode: backwards;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0, 217, 255, 0.05), transparent);
      transition: left 0.6s ease;
    }

    .card:hover::before {
      left: 100%;
    }

    .card:nth-child(1) {
      animation-delay: 0.1s;
    }

    .card:nth-child(2) {
      animation-delay: 0.15s;
    }

    .card:nth-child(3) {
      animation-delay: 0.2s;
    }

    .card:nth-child(4) {
      animation-delay: 0.25s;
    }

    .card:hover {
      border-color: var(--border-accent);
      box-shadow: 0 8px 32px rgba(0, 217, 255, 0.15), 0 0 20px rgba(0, 217, 255, 0.1);
      transform: translateY(-4px);
    }

    .card-header {
      font-size: 15px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-tertiary));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 18px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border-subtle);
      text-transform: uppercase;
      letter-spacing: 0.8px;
      position: relative;
    }

    .card-header::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      width: 60px;
      height: 2px;
      background: linear-gradient(90deg, var(--accent-primary), transparent);
    }

    .control-group {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 0;
      border-bottom: 1px solid rgba(0, 217, 255, 0.04);
      transition: all 0.3s ease;
      position: relative;
    }

    .control-group::before {
      content: '';
      position: absolute;
      left: -24px;
      top: 0;
      bottom: 0;
      width: 3px;
      background: var(--accent-primary);
      opacity: 0;
      transition: opacity 0.3s ease;
      border-radius: 0 3px 3px 0;
    }

    .control-group:hover {
      background: rgba(0, 217, 255, 0.03);
      padding-left: 12px;
      margin-left: -12px;
      margin-right: -12px;
      padding-right: 12px;
      border-radius: 8px;
    }

    .control-group:hover::before {
      opacity: 1;
    }

    .control-group:last-child {
      border-bottom: none;
    }

    .control-label {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      flex: 1;
    }

    .control-input {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .input {
      padding: 10px 14px;
      background: rgba(22, 27, 38, 0.8);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      font-size: 13px;
      color: var(--text-primary);
      width: 90px;
      transition: all 0.3s;
      font-weight: 500;
    }

    .input:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px rgba(0, 217, 255, 0.15), 0 0 15px rgba(0, 217, 255, 0.2);
      background: rgba(26, 32, 48, 0.9);
    }

    .input-wide {
      width: 220px;
    }

    .select {
      padding: 10px 14px;
      background: rgba(22, 27, 38, 0.8);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      font-size: 13px;
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
    }

    .select:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px rgba(0, 217, 255, 0.15);
    }

    .hotkey-badge {
      padding: 8px 16px;
      background: linear-gradient(135deg, rgba(0, 217, 255, 0.15), rgba(0, 153, 255, 0.1));
      border: 1px solid var(--border-accent);
      border-radius: 8px;
      font-weight: 700;
      color: var(--accent-primary);
      text-transform: uppercase;
      font-size: 12px;
      letter-spacing: 1.2px;
      box-shadow: 0 0 15px rgba(0, 217, 255, 0.2);
      transition: all 0.3s ease;
    }

    .hotkey-badge:hover {
      box-shadow: 0 0 25px rgba(0, 217, 255, 0.4);
      transform: translateY(-2px);
    }

    .btn {
      padding: 9px 18px;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 12px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 0 4px 15px rgba(0, 217, 255, 0.3);
      position: relative;
      overflow: hidden;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transform: translate(-50%, -50%);
      transition: width 0.5s, height 0.5s;
    }

    .btn:hover::before {
      width: 300px;
      height: 300px;
    }

    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 25px rgba(0, 217, 255, 0.5);
    }

    .btn:active {
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: linear-gradient(135deg, rgba(22, 27, 38, 0.9), rgba(26, 32, 48, 0.9));
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      border: 1px solid var(--border-subtle);
    }

    .btn-secondary:hover {
      background: linear-gradient(135deg, rgba(26, 32, 48, 0.9), rgba(22, 27, 38, 0.9));
      box-shadow: 0 6px 20px rgba(0, 217, 255, 0.2);
      border-color: var(--border-accent);
    }

    .btn-sm {
      padding: 7px 14px;
      font-size: 11px;
    }

    .toggle-switch {
      position: relative;
      width: 50px;
      height: 26px;
      background: rgba(22, 27, 38, 0.8);
      border-radius: 13px;
      cursor: pointer;
      transition: all 0.4s;
      border: 1px solid var(--border-subtle);
      box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
    }

    .toggle-switch.active {
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      box-shadow: 0 0 20px rgba(0, 217, 255, 0.5);
      border-color: var(--accent-primary);
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
    }

    .toggle-switch.active::after {
      transform: translateX(24px);
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
    }

    .toggle-switch.disabled {
      opacity: 0.4;
      cursor: not-allowed;
      pointer-events: none;
    }

    .point-indicator {
      padding: 8px 14px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      white-space: nowrap;
      transition: all 0.3s ease;
    }

    .point-indicator.set {
      background: linear-gradient(135deg, rgba(0, 255, 170, 0.15), rgba(0, 217, 255, 0.1));
      color: var(--success);
      border: 1px solid rgba(0, 255, 170, 0.3);
      box-shadow: 0 0 15px rgba(0, 255, 170, 0.2);
    }

    .point-indicator.unset {
      background: rgba(255, 68, 102, 0.1);
      color: var(--danger);
      border: 1px solid rgba(255, 68, 102, 0.3);
    }

    .expandable-section {
      margin-top: 14px;
      padding-left: 14px;
      border-left: 3px solid var(--border-accent);
      display: none;
      overflow: hidden;
    }

    .expandable-section.expanded {
      display: block;
      animation: slideDown 0.4s ease-out;
    }

    .requirement-warning {
      display: none;
      background: linear-gradient(135deg, rgba(255, 68, 102, 0.12), rgba(255, 170, 0, 0.08));
      border: 1px solid rgba(255, 68, 102, 0.3);
      border-radius: 10px;
      padding: 14px;
      margin-top: 14px;
      font-size: 12px;
      color: #ffaabb;
      line-height: 1.6;
      animation: slideDown 0.3s ease-out;
    }

    .requirement-warning.show {
      display: block;
    }

    .requirement-warning strong {
      color: var(--danger);
    }

    .requirement-warning a {
      color: var(--accent-primary);
      text-decoration: underline;
      cursor: pointer;
    }

    .unit {
      font-size: 12px;
      color: var(--text-muted);
      font-weight: 500;
    }

    .help-hint {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 8px;
      font-style: italic;
      opacity: 0.8;
    }

    .rdp-indicator {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 8px 16px;
      background: rgba(22, 27, 38, 0.8);
      border: 1px solid var(--border-subtle);
      border-radius: 10px;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .rdp-indicator.active {
      background: linear-gradient(135deg, rgba(0, 153, 255, 0.15), rgba(0, 217, 255, 0.1));
      border-color: rgba(0, 153, 255, 0.4);
      color: #60a5fa;
      box-shadow: 0 0 15px rgba(0, 153, 255, 0.3);
    }

    .rdp-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: currentColor;
      animation: pulse 2s ease-in-out infinite;
    }

    .device-card {
      background: linear-gradient(135deg, rgba(26, 32, 48, 0.5), rgba(22, 27, 38, 0.5));
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      transition: all 0.3s ease;
      animation: slideInRight 0.4s ease-out;
      backdrop-filter: blur(10px);
    }

    .device-card:hover {
      border-color: var(--border-accent);
      transform: translateX(-4px);
      box-shadow: 0 4px 20px rgba(0, 217, 255, 0.15);
    }

    .device-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .device-name {
      font-size: 14px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .device-status {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 5px 12px;
      background: linear-gradient(135deg, rgba(0, 255, 170, 0.15), rgba(0, 217, 255, 0.1));
      border: 1px solid rgba(0, 255, 170, 0.3);
      border-radius: 8px;
      font-size: 11px;
      font-weight: 600;
      color: var(--success);
    }

    .device-status.offline {
      background: rgba(255, 68, 102, 0.1);
      border-color: rgba(255, 68, 102, 0.3);
      color: var(--danger);
    }

    .device-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 10px;
    }

    .device-stat {
      text-align: center;
      padding: 10px;
      background: rgba(10, 14, 26, 0.4);
      border-radius: 8px;
      transition: all 0.2s ease;
      border: 1px solid transparent;
    }

    .device-stat:hover {
      background: rgba(0, 217, 255, 0.05);
      border-color: var(--border-subtle);
    }

    .device-stat-label {
      font-size: 10px;
      color: var(--text-muted);
      text-transform: uppercase;
      margin-bottom: 5px;
    }

    .device-stat-value {
      font-size: 16px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-tertiary));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .sync-status {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 16px;
      background: linear-gradient(135deg, rgba(0, 255, 170, 0.15), rgba(0, 217, 255, 0.1));
      border: 1px solid rgba(0, 255, 170, 0.3);
      border-radius: 10px;
      font-size: 12px;
      color: var(--success);
    }

    .sync-status i {
      animation: spin 2s linear infinite;
    }

    .hero-section {
      background: linear-gradient(135deg, rgba(0, 217, 255, 0.08), rgba(0, 153, 255, 0.05));
      border: 1px solid var(--border-accent);
      border-radius: 20px;
      padding: 40px;
      margin-bottom: 28px;
      text-align: center;
      animation: slideInRight 0.6s ease-out;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(10px);
    }

    .hero-section::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(0, 217, 255, 0.1) 0%, transparent 70%);
      animation: float 15s ease-in-out infinite;
    }

    .hero-title {
      font-size: 32px;
      font-weight: 800;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-tertiary));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 12px;
      position: relative;
      letter-spacing: -0.5px;
    }

    .hero-subtitle {
      font-size: 15px;
      color: var(--text-secondary);
      line-height: 1.7;
      max-width: 650px;
      margin: 0 auto 28px;
      position: relative;
    }

    .quick-links {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
      position: relative;
    }

    .quick-link {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 12px 24px;
      background: linear-gradient(135deg, rgba(26, 32, 48, 0.8), rgba(22, 27, 38, 0.8));
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      color: var(--text-primary);
      text-decoration: none;
      font-weight: 600;
      font-size: 13px;
      transition: all 0.3s;
      backdrop-filter: blur(10px);
    }

    .quick-link:hover {
      background: linear-gradient(135deg, rgba(0, 217, 255, 0.15), rgba(0, 153, 255, 0.1));
      border-color: var(--border-accent);
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0, 217, 255, 0.25);
    }

    .quick-link-icon {
      font-size: 18px;
    }

    .tips-section {
      background: linear-gradient(135deg, rgba(0, 153, 255, 0.08), rgba(0, 217, 255, 0.05));
      border: 1px solid var(--border-accent);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      animation: slideInRight 0.7s ease-out;
      backdrop-filter: blur(10px);
    }

    .tips-title {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 18px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-tertiary));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 16px;
    }

    .tip-item {
      display: flex;
      gap: 14px;
      padding: 12px 0;
      border-bottom: 1px solid rgba(0, 217, 255, 0.08);
      transition: all 0.2s ease;
    }

    .tip-item:hover {
      padding-left: 8px;
      background: rgba(0, 217, 255, 0.03);
      border-radius: 8px;
    }

    .tip-item:last-child {
      border-bottom: none;
    }

    .tip-icon {
      font-size: 20px;
      color: var(--success);
      flex-shrink: 0;
    }

    .tip-text {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.7;
    }

    .tip-text strong {
      color: var(--text-primary);
    }

    .slideshow-card {
      background: linear-gradient(135deg, rgba(26, 32, 48, 0.6), rgba(22, 27, 38, 0.6));
      border: 1px solid var(--border-subtle);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      transition: all 0.3s ease;
      animation: slideInRight 0.8s ease-out;
      backdrop-filter: blur(20px);
    }

    .slideshow-card:hover {
      border-color: var(--border-accent);
    }

    .slideshow-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 18px;
      flex-wrap: wrap;
    }

    .slideshow-tab {
      padding: 10px 20px;
      border-radius: 8px;
      border: 1px solid var(--border-subtle);
      background: rgba(22, 27, 38, 0.8);
      color: var(--text-secondary);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .slideshow-tab:hover {
      color: var(--text-primary);
      border-color: var(--border-accent);
      background: rgba(26, 32, 48, 0.9);
    }

    .slideshow-tab.active {
      background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(0, 153, 255, 0.15));
      border-color: var(--border-accent);
      color: var(--accent-primary);
      box-shadow: 0 0 15px rgba(0, 217, 255, 0.3);
    }

    .slideshow-viewport {
      position: relative;
      width: 100%;
      border-radius: 12px;
      overflow: hidden;
      background: #000;
      aspect-ratio: 16 / 9;
      border: 1px solid var(--border-subtle);
    }

    .slide {
      position: absolute;
      inset: 0;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.5s ease, visibility 0.5s ease;
      display: flex;
      align-items: stretch;
      pointer-events: none;
      z-index: 0;
    }

    .slide.visible {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
      z-index: 1;
    }

    .slide img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .slide-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      background: linear-gradient(to top, rgba(0, 0, 0, 0.85) 0%, transparent 60%);
      opacity: 1;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }

    .slide:hover .slide-overlay {
      opacity: 0;
    }

    .slide-overlay-inner {
      padding: 20px 24px;
    }

    .slide-overlay-title {
      font-size: 16px;
      font-weight: 700;
      color: #fff;
      margin-bottom: 6px;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.7);
    }

    .slide-overlay-desc {
      font-size: 13px;
      color: #d0d8e8;
      line-height: 1.5;
      text-shadow: 0 1px 6px rgba(0, 0, 0, 0.6);
    }

    .slide-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      z-index: 3;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: 1px solid var(--border-accent);
      background: rgba(10, 14, 26, 0.8);
      backdrop-filter: blur(10px);
      color: var(--accent-primary);
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
      user-select: none;
    }

    .slide-nav:hover {
      background: rgba(0, 217, 255, 0.25);
      border-color: var(--accent-primary);
      box-shadow: 0 0 20px rgba(0, 217, 255, 0.5);
      transform: translateY(-50%) scale(1.1);
    }

    .slide-nav.prev {
      left: 12px;
    }

    .slide-nav.next {
      right: 12px;
    }

    .slide-dots {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 14px;
    }

    .slide-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--border-accent);
      cursor: pointer;
      transition: all 0.3s;
    }

    .slide-dot.active {
      background: var(--accent-primary);
      box-shadow: 0 0 12px rgba(0, 217, 255, 0.6);
      transform: scale(1.4);
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.92);
      backdrop-filter: blur(15px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      animation: fadeIn 0.3s ease-out;
    }

    .modal-overlay.hidden {
      display: none;
    }

    .modal-container {
      background: linear-gradient(135deg, rgba(26, 32, 48, 0.95), rgba(22, 27, 38, 0.95));
      border: 1px solid var(--border-accent);
      border-radius: 20px;
      display: flex;
      flex-direction: column;
      max-width: 520px;
      max-height: 85vh;
      width: 90%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7), 0 0 80px rgba(0, 217, 255, 0.2);
      overflow: hidden;
      animation: slideInRight 0.4s ease-out;
      backdrop-filter: blur(20px);
    }

    .modal-header {
      background: linear-gradient(135deg, rgba(0, 217, 255, 0.15), rgba(0, 153, 255, 0.08));
      padding: 32px 32px 24px 32px;
      border-bottom: 1px solid var(--border-subtle);
      text-align: center;
    }

    .modal-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .modal-header h2 {
      font-size: 26px;
      font-weight: 800;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-tertiary));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .modal-body {
      padding: 32px;
      overflow-y: auto;
      flex: 1;
    }

    .modal-body::-webkit-scrollbar {
      width: 5px;
    }

    .modal-body::-webkit-scrollbar-track {
      background: rgba(22, 27, 38, 0.5);
    }

    .modal-body::-webkit-scrollbar-thumb {
      background: var(--border-accent);
      border-radius: 3px;
    }

    .disclaimer-section {
      margin-bottom: 24px;
    }

    .disclaimer-section h3 {
      color: var(--accent-primary);
      font-size: 17px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .disclaimer-section p {
      color: var(--text-secondary);
      font-size: 14px;
      line-height: 1.7;
      margin-bottom: 8px;
    }

    .creator-name {
      color: var(--accent-primary);
      font-weight: 700;
      font-size: 17px;
    }

    .credit-notice {
      font-style: italic;
      color: var(--text-muted);
      font-size: 13px;
    }

    .warning-box {
      background: linear-gradient(135deg, rgba(255, 68, 102, 0.12), rgba(255, 170, 0, 0.08));
      border: 1px solid rgba(255, 68, 102, 0.3);
      border-radius: 12px;
      padding: 16px;
    }

    .warning-box p {
      color: #ffaabb;
    }

    .modal-footer {
      padding: 24px 32px;
      background: rgba(10, 14, 26, 0.5);
      border-top: 1px solid var(--border-subtle);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .checkbox-container {
      display: flex;
      align-items: center;
      cursor: pointer;
    }

    .checkbox-container input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin-right: 10px;
      cursor: pointer;
      accent-color: var(--accent-primary);
    }

    .checkbox-label {
      color: var(--text-secondary);
      font-size: 13px;
    }

    .btn-primary {
      padding: 12px 32px;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
      font-size: 13px;
      transition: all 0.3s;
      box-shadow: 0 4px 20px rgba(0, 217, 255, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 30px rgba(0, 217, 255, 0.6);
    }

    #updateBanner {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(135deg, var(--success), #00cc88);
      color: white;
      padding: 14px 24px;
      text-align: center;
      z-index: 10002;
      box-shadow: 0 4px 20px rgba(0, 255, 170, 0.4);
      animation: slideDown 0.4s ease-out;
    }

    #updateBanner button {
      transition: all 0.3s ease;
    }

    #updateBanner button:hover {
      transform: translateY(-2px);
    }

    .slot-button {
      min-width: 40px;
      padding: 8px 12px;
      transition: all 0.3s ease;
    }

    .slot-button:hover {
      transform: scale(1.08);
    }

    .recipe-item {
      position: relative;
    }

    .recipe-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -24px;
      bottom: 0;
      width: 3px;
      background: var(--accent-primary);
      opacity: 0;
      transition: opacity 0.3s ease;
      border-radius: 0 3px 3px 0;
    }

    .recipe-item:hover::before {
      opacity: 1;
    }
  </style>
</head>

<body>
  <div id="updateBanner" style="display: none;">
    <div style="display: flex; align-items: center; justify-content: center; gap: 16px; flex-wrap: wrap;">
      <span style="font-weight: 600; font-size: 14px;">
        New version available: <strong id="newVersionText">v0.0.0</strong>
      </span>
      <button onclick="downloadUpdate()"
        style="padding: 8px 24px; background: white; color: #00cc88; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 13px;">
        Download Update
      </button>
      <button onclick="dismissBanner()"
        style="padding: 8px 20px; background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.4); border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 13px;">
        Dismiss
      </button>
    </div>
  </div>

  <div class="container">
    <div class="header">
      <div class="brand">
        <div class="logo"><span>K</span></div>
        <div class="title-group">
          <h1>K's GPO Fishing Macro</h1>
          <div style="display: flex; align-items: center; gap: 8px;">
            <div class="version">Version 1.2.7</div>
            <div style="color: var(--accent-tertiary); opacity: 0.7; font-size: 0.75em;">Production</div>
          </div>
        </div>
      </div>
      <div style="display: flex; align-items: center; gap: 12px;">
        <div class="rdp-indicator" id="rdpIndicator">
          <div class="rdp-dot"></div>
          <span id="rdpText">Local Session</span>
        </div>
        <div class="status-badge">
          <div class="status-dot" id="statusDot"></div>
          <span class="status-text" id="statusText">Inactive</span>
        </div>
      </div>
    </div>

    <div class="main-content">
      <div class="sidebar">
        <div class="nav-item active" data-view="home">
          <i data-lucide="home"></i>
          <span>Dashboard</span>
        </div>
        <div class="nav-item" data-view="controls">
          <i data-lucide="sliders"></i>
          <span>Control Center</span>
        </div>
        <div class="nav-item" data-view="locations">
          <i data-lucide="map-pin"></i>
          <span>Locations</span>
        </div>
        <div class="nav-item" data-view="automation">
          <i data-lucide="workflow"></i>
          <span>Automation</span>
        </div>
        <div class="nav-item" data-view="logging">
          <i data-lucide="file-text"></i>
          <span>Logging</span>
        </div>
        <div class="nav-item" data-view="fishing-modes">
          <i data-lucide="fish"></i>
          <span>Fishing Modes</span>
        </div>
        <div class="nav-item" data-view="tuning">
          <i data-lucide="settings"></i>
          <span>Tuning</span>
        </div>
        <div class="nav-item" data-view="timing">
          <i data-lucide="clock"></i>
          <span>Timing</span>
        </div>
        <div class="nav-item" data-view="settings">
          <i data-lucide="cog"></i>
          <span>Settings</span>
        </div>
      </div>

      <div class="content-area">
        <div class="view active" id="home">
          <div class="hero-section">
            <h1 class="hero-title">Welcome to K's GPO Fishing Macro</h1>
            <p class="hero-subtitle">
              An advanced automation tool for Grand Piece Online fishing. Configure your settings, set up locations, and
              start fishing efficiently!
            </p>
            <div class="quick-links">
              <a href="https://github.com/K3nD4rk-Code-Developer/Grand-Piece-Online-Fishing" target="_blank"
                class="quick-link">
                <span class="quick-link-icon"><i class="fab fa-github"></i></span>
                GitHub Repository
              </a>
              <a href="https://discord.com/invite/vKVBbyfHTD" target="_blank" class="quick-link">
                <span class="quick-link-icon"><i class="fab fa-discord"></i></span>
                Discord Community
              </a>
              <a href="https://youtu.be/Ynnp3DKCJgM" target="_blank" class="quick-link">
                <span class="quick-link-icon"><i class="fab fa-youtube"></i></span>
                Video Tutorial
              </a>
            </div>
          </div>

          <div class="tips-section">
            <div class="tips-title">
              Essential Setup Tips
            </div>
            <div class="tip-item">
              <div class="tip-text">
                <strong>Run As Admin:</strong> Run the app as Admin to give it more CPU resources.
              </div>
            </div>
            <div class="tip-item">
              <div class="tip-text">
                <strong>FPS Cap:</strong> Set your in-game FPS to your monitors refresh rate to prevent missed catches.
              </div>
            </div>
            <div class="tip-item">
              <div class="tip-text">
                <strong>Camera Zoom:</strong> Keep your camera zoomed enough to see the bar closely enough but not too
                much it's above other UI's.
              </div>
            </div>
            <div class="tip-item">
              <div class="tip-text">
                <strong>Cartoonize Your Gameplay:</strong> Set your graphics to 1, turn on fast mode in your GPO
                settings, and turn off shadows.
              </div>
            </div>
          </div>

          <div class="slideshow-card">
            <div class="card-header" style="margin-bottom:16px;">Visual Guides</div>

            <div class="slideshow-tabs" id="slideshowTabs"></div>

            <div class="slideshow-viewport" id="slideshowViewport">
              <button class="slide-nav prev" id="slidePrev">&#8249;</button>
              <button class="slide-nav next" id="slideNext">&#8250;</button>
            </div>

            <div class="slide-dots" id="slideDots"></div>
          </div>

          <div class="card">
            <div class="card-header">Troubleshooting</div>
            <div class="tip-item">
              <div class="tip-text">
                <strong>Macro won't start:</strong> Ensure that your water point and selected rods are correct.
              </div>
            </div>
            <div class="tip-item">
              <div class="tip-text">
                <strong>Missing fish games:</strong> Adjust the scan area so it fully covers the fishing bar (and a bit
                beyond). Make sure Roblox is running at your
                monitor's refresh rate, the bar doesn't overlap with others UI, and run app as admin.
              </div>
            </div>
            <div class="tip-item">
              <div class="tip-text">
                <strong>Not casting:</strong> Verify Water Point is set correctly. Check that fishing rod is in the
                correct inventory slot.
              </div>
            </div>
            <div class="tip-item">
              <div class="tip-text">
                <strong>Auto-buy failing:</strong> Reconfigure bait shop points. Increase Pre-Cast delays in Timing â†’
                Purchase Interaction Timing.
              </div>
            </div>
            <div class="tip-item">
              <div class="tip-text">
                <strong>Actions too fast/slow:</strong> Adjust timing delays in the Timing tab. Add 0.1-0.2s to delays
                if actions are being skipped.
              </div>
            </div>
          </div>
        </div>

        <div class="view" id="controls">
          <div class="card">
            <div class="card-header">Keybinds</div>
            <div class="control-group">
              <span class="control-label">Start/Stop Macro</span>
              <div class="control-input">
                <div class="hotkey-badge" id="hotkey-start">F1</div>
                <button class="btn btn-sm" onclick="sendToPython('rebind_hotkey', 'start_stop')">Rebind</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Exit Application</span>
              <div class="control-input">
                <div class="hotkey-badge" id="hotkey-exit">F3</div>
                <button class="btn btn-sm" onclick="sendToPython('rebind_hotkey', 'exit')">Rebind</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Configure Scan Area</span>
              <div class="control-input">
                <button class="btn btn-sm" onclick="sendToPython('open_area_selector', '')">Open Area Selector</button>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">Inventory Slots</div>
            <div class="control-group">
              <span class="control-label">Fishing Rod Slot</span>
              <div class="control-input">
                <select class="select" id="rodHotkey" onchange="validateAndSetRodSlot(this.value)">
                  <option selected>1</option>
                  <option>2</option>
                  <option>3</option>
                  <option>4</option>
                  <option>5</option>
                  <option>6</option>
                  <option>7</option>
                  <option>8</option>
                  <option>9</option>
                  <option>0</option>
                </select>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Secondary Item Slot</span>
              <div class="control-input">
                <select class="select" id="anythingElseHotkey" onchange="validateAndSetSecondarySlot(this.value)">
                  <option>1</option>
                  <option selected>2</option>
                  <option>3</option>
                  <option>4</option>
                  <option>5</option>
                  <option>6</option>
                  <option>7</option>
                  <option>8</option>
                  <option>9</option>
                  <option>0</option>
                </select>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Devil Fruit Slots</span>
              <div class="control-input" style="margin-left: 20px;">
                <div id="devilFruitSlotSelector" style="display: flex; gap: 8px; flex-wrap: wrap;"></div>
              </div>
            </div>
            <div class="help-hint">Select multiple slots to check for devil fruits</div>
          </div>
          <div class="card">
            <div class="card-header">Application Settings</div>
            <div class="control-group">
              <span class="control-label">Keep Window on Top</span>
              <div class="control-input">
                <div class="toggle-switch" id="alwaysOnTopToggle" onclick="toggleSetting('alwaysOnTop')"></div>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Display Statistics Overlay</span>
              <div class="control-input">
                <div class="toggle-switch" id="debugOverlayToggle" onclick="toggleSetting('debugOverlay')"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="view" id="locations">
          <div class="card">
            <div class="card-header">Primary Fishing Location</div>
            <div class="control-group">
              <span class="control-label">Water Target Point</span>
              <div class="control-input">
                <span class="point-indicator unset" id="waterPointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_water_point', '')">Configure</button>
              </div>
            </div>
            <div class="help-hint">Click the location in water where you want to cast your fishing line</div>
          </div>
          <div class="card">
            <div class="card-header">Bait Shop Interaction Points</div>
            <div class="control-group">
              <span class="control-label">Left Dialog Option</span>
              <div class="control-input">
                <span class="point-indicator unset" id="leftPointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_left_point', '')">Configure</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Middle Dialog Option</span>
              <div class="control-input">
                <span class="point-indicator unset" id="middlePointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_middle_point', '')">Configure</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Right Dialog Option</span>
              <div class="control-input">
                <span class="point-indicator unset" id="rightPointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_right_point', '')">Configure</button>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">Crafting Interface Points</div>
            <div class="control-group">
              <span class="control-label">Left Dialog Option</span>
              <div class="control-input">
                <span class="point-indicator unset" id="craftLeftPointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_craft_left_point', '')">Configure</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Middle Dialog Option</span>
              <div class="control-input">
                <span class="point-indicator unset" id="craftMiddlePointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_craft_middle_point', '')">Configure</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Add Ingredient</span>
              <div class="control-input">
                <span class="point-indicator unset" id="addRecipePointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_add_recipe_point', '')">Configure</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Top Recipe Slot</span>
              <div class="control-input">
                <span class="point-indicator unset" id="topRecipePointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_top_recipe_point', '')">Configure</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Click Craft Confirm</span>
              <div class="control-input">
                <span class="point-indicator unset" id="craftButtonPointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_craft_button_point', '')">Configure</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Menu Close</span>
              <div class="control-input">
                <span class="point-indicator unset" id="closeMenuPointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_close_menu_point', '')">Configure</button>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              Crafting Recipes
              <button class="btn btn-sm" onclick="addNewRecipe()" style="float: right;">+ Add Recipe</button>
            </div>
            <div id="RecipesContainer"></div>
          </div>
          <div class="card">
            <div class="card-header">Devil Fruit Locations</div>
            <div class="control-group">
              <span class="control-label">Devil Fruit Store</span>
              <div class="control-input">
                <span class="point-indicator unset" id="storeFruitPointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_store_fruit_point', '')">Configure</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Devil Fruit Backpack</span>
              <div class="control-input">
                <span class="point-indicator unset" id="devilFruitLocationPointStatus">Not Configured</span>
                <button class="btn btn-sm"
                  onclick="sendToPython('set_devil_fruit_location_point', '')">Configure</button>
              </div>
            </div>
            <div class="help-hint">This feature is still a work in progress, don't mind it. Used for storing inside of
              backpack instead of drop</div>
          </div>
          <div class="card">
            <div class="card-header">Bait Locations</div>
            <div class="control-group">
              <span class="control-label">Top Bait Point</span>
              <div class="control-input">
                <span class="point-indicator unset" id="baitPointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_bait_point', '')">Configure</button>
              </div>
            </div>
          </div>
        </div>

        <div class="view" id="automation">
          <div class="card">
            <div class="card-header">Auto Purchase Bait</div>
            <div class="control-group">
              <span class="control-label">Enable Auto Buy Common Bait</span>
              <div class="control-input">
                <div class="toggle-switch" id="autoBuyBaitToggle"
                  onclick="toggleExpandable('autoBuyBait', 'autoBuyExpand')"></div>
              </div>
            </div>
            <div class="requirement-warning" id="autoBuyBaitWarning">
              <strong>âš ï¸ Missing Requirements:</strong><br>
              You need to configure all Bait Shop points first.<br>
              Go to <a onclick="navigateToLocations()">Locations â†’ Bait Shop Interaction Points</a>
            </div>
            <div class="expandable-section" id="autoBuyExpand">
              <div class="control-group">
                <span class="control-label">Purchase Frequency</span>
                <div class="control-input">
                  <input type="number" class="input" id="loopsPerPurchase" value="100" step="1"
                    onchange="sendToPython('set_loops_per_purchase', this.value)">
                  <span class="unit">loops</span>
                </div>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">Auto Craft Bait</div>
            <div class="control-group">
              <span class="control-label">Enable Auto Craft</span>
              <div class="control-input">
                <div class="toggle-switch" id="autoCraftBaitToggle"
                  onclick="toggleExpandable('autoCraftBait', 'autoCraftExpand')"></div>
              </div>
            </div>
            <div class="requirement-warning" id="autoCraftBaitWarning">
              <strong>Missing Requirements:</strong><br>
              You need to configure all crafting points and recipes first.<br>
              Go to <a onclick="navigateToLocations()">Locations â†’ Crafting Interface Points</a>
            </div>
            <div class="expandable-section" id="autoCraftExpand">
              <div class="control-group">
                <span class="control-label">Fish Caught Before Craft</span>
                <div class="control-input">
                  <input type="number" class="input" id="fishCountPerCraft" value="50" step="1" min="1"
                    onchange="sendToPython('set_fish_count_per_craft', this.value)">
                  <span class="unit">fish</span>
                </div>
              </div>
              <div class="control-group">
                <span class="control-label">Movement Duration</span>
                <div class="control-input">
                  <input type="number" class="input" id="moveDuration" value="0" step="0.25"
                    onchange="sendToPython('set_move_duration', this.value)">
                  <span class="unit">seconds</span>
                </div>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">Auto Store Devil Fruit</div>
            <div class="control-group">
              <span class="control-label">Enable Auto Storage</span>
              <div class="control-input">
                <div class="toggle-switch" id="autoStoreFruitToggle"
                  onclick="toggleExpandable('autoStoreFruit', 'autoStoreExpand')"></div>
              </div>
            </div>
            <div class="requirement-warning" id="autoStoreFruitWarning">
              <strong>Missing Requirements:</strong><br>
              You need to configure the Devil Fruit Store location first.<br>
              Go to <a onclick="navigateToLocations()">Locations â†’ Devil Fruit Locations</a>
            </div>
            <div class="expandable-section" id="autoStoreExpand">
              <div class="control-group">
                <span class="control-label">Store to Backpack (vs Drop)</span>
                <div class="control-input">
                  <div class="toggle-switch disabled" id="storeToBackpackToggle"
                    style="opacity: 0.5; cursor: not-allowed; pointer-events: none;"></div>
                  <span style="color: #6b7a92; font-size: 10px; font-style: italic; margin-left: 8px;">Coming
                    Soon</span>
                </div>
              </div>
              <div class="control-group">
                <span class="control-label">Storage Frequency</span>
                <div class="control-input">
                  <input type="number" class="input" id="loopsPerStore" value="1" step="1" min="1"
                    onchange="sendToPython('set_loops_per_store', this.value)">
                  <span class="unit">loops</span>
                </div>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">Auto Select Bait</div>
            <div class="control-group">
              <span class="control-label">Enable Auto Select Top Bait</span>
              <div class="control-input">
                <div class="toggle-switch" id="autoSelectBaitToggle" onclick="toggleSetting('autoSelectBait')"></div>
              </div>
            </div>
            <div class="requirement-warning" id="autoSelectBaitWarning">
              <strong>Missing Requirements:</strong><br>
              You need to configure the Top Bait Point first.<br>
              Go to <a onclick="navigateToLocations()">Locations â†’ Bait Locations</a>
            </div>
          </div>
        </div>

        <div class="view" id="logging">
          <div class="card">
            <div class="card-header">Webhook Configuration</div>
            <div class="control-group">
              <span class="control-label">Discord Webhook URL</span>
              <div class="control-input">
                <input type="text" class="input input-wide" id="webhookUrl"
                  placeholder="https://discord.com/api/webhooks/..."
                  onchange="sendToPython('set_webhook_url', this.value)">
              </div>
            </div>
            <div class="help-hint">Paste your Discord webhook URL to receive notifications</div>
            <div class="control-group">
              <span class="control-label">Test Webhook</span>
              <div class="control-input">
                <button class="btn btn-sm" onclick="testWebhook()">Send Test Message</button>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Webhook Notifications</div>
            <div class="control-group">
              <span class="control-label">Enable Pinging</span>
              <div class="control-input">
                <div class="toggle-switch" id="webhookPingToggle" onclick="toggleSetting('webhookPing')"></div>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Log Devil Fruit Stored</span>
              <div class="control-input">
                <div class="toggle-switch" id="logDevilFruitToggle" onclick="toggleSetting('logDevilFruit')"></div>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Log Recast Timeouts</span>
              <div class="control-input">
                <div class="toggle-switch" id="logRecastTimeoutsToggle" onclick="toggleSetting('logRecastTimeouts')">
                </div>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Log Periodic Stats</span>
              <div class="control-input">
                <div class="toggle-switch" id="logPeriodicStatsToggle" onclick="toggleSetting('logPeriodicStats')">
                </div>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Log General Updates</span>
              <div class="control-input">
                <div class="toggle-switch" id="logGeneralUpdatesToggle" onclick="toggleSetting('logGeneralUpdates')">
                </div>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Stats Report Interval</span>
              <div class="control-input">
                <input type="number" class="input" id="periodicStatsInterval" value="5" step="1" min="1"
                  onchange="sendToPython('set_periodic_stats_interval', this.value)">
                <span class="unit">minutes</span>
              </div>
            </div>
            <div class="help-hint">Configure which events and how frequently notifications are sent to your webhook
            </div>
          </div>
        </div>

        <div class="view" id="fishing-modes">
          <div class="card">
            <div class="card-header">Megalodon Mode</div>
            <div class="control-group">
              <span class="control-label">Enable Megalodon Sound Recognition</span>
              <div class="control-input">
                <div class="toggle-switch" id="megalodonSoundToggle" onclick="toggleSetting('megalodonSound')"></div>
              </div>
            </div>
            <div class="help-hint">Listens for Megalodon roar sound and only continues fishing if detected</div>
            <div class="control-group">
              <span class="control-label">Sound Sensitivity</span>
              <div class="control-input">
                <input type="number" class="input" id="soundSensitivity" value="0.1" step="0.1" min="0" max="1"
                  onchange="sendToPython('set_sound_sensitivity', this.value)">
                <span class="unit">threshold</span>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">RDP Session Detection</div>
            <div class="control-group">
              <span class="control-label">Current Session Type</span>
              <div class="control-input">
                <span class="rdp-indicator" id="sessionTypeIndicator">
                  <div class="rdp-dot"></div>
                  <span id="sessionTypeText">Detecting...</span>
                </span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Auto-Detect RDP Sessions</span>
              <div class="control-input">
                <div class="toggle-switch active" id="autoDetectRdpToggle" onclick="toggleSetting('autoDetectRdp')">
                </div>
              </div>
            </div>
            <div class="help-hint">Automatically detect when running in Remote Desktop and adjust behavior</div>
          </div>

          <div class="card">
            <div class="card-header">Multi-Device Sync</div>
            <div class="control-group">
              <span class="control-label">Enable Device Synchronization</span>
              <div class="control-input">
                <div class="toggle-switch" id="enableDeviceSyncToggle"
                  onclick="toggleExpandable('enableDeviceSync', 'deviceSyncExpand')"></div>
              </div>
            </div>
            <div class="expandable-section" id="deviceSyncExpand">
              <div class="control-group">
                <span class="control-label">Sync Settings Across Devices</span>
                <div class="control-input">
                  <div class="toggle-switch active" id="syncSettingsToggle" onclick="toggleSetting('syncSettings')">
                  </div>
                </div>
              </div>
              <div class="control-group">
                <span class="control-label">Sync Statistics</span>
                <div class="control-input">
                  <div class="toggle-switch active" id="syncStatsToggle" onclick="toggleSetting('syncStats')"></div>
                </div>
              </div>
              <div class="control-group">
                <span class="control-label">Share Fish Count Across Devices</span>
                <div class="control-input">
                  <div class="toggle-switch" id="sharesFishCountToggle" onclick="toggleSetting('shareFishCount')"></div>
                </div>
              </div>
              <div class="control-group">
                <span class="control-label">Sync Interval</span>
                <div class="control-input">
                  <input type="number" class="input" id="syncInterval" value="5" step="1" min="1" max="60"
                    onchange="sendToPython('set_sync_interval', this.value)">
                  <span class="unit">seconds</span>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Active Sessions</div>
            <div id="activeSessionsContainer">
              <div style="text-align:center;padding:20px;color:#6b7a92;">
                Loading sessions...
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Client Identification</div>
            <div class="control-group">
              <span class="control-label">Device Name</span>
              <div class="control-input">
                <input type="text" class="input input-wide" id="deviceName" placeholder="My Gaming PC"
                  onchange="sendToPython('set_device_name', this.value)">
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Client ID</span>
              <div class="control-input">
                <span class="hotkey-badge" id="clientIdDisplay"
                  style="font-size: 9px; letter-spacing: 0;">Loading...</span>
                <button class="btn btn-sm btn-secondary" onclick="regenerateClientId()">Regenerate</button>
              </div>
            </div>
            <div class="help-hint">Each device has a unique ID for tracking and synchronization</div>
          </div>
        </div>

        <div class="view" id="tuning">
          <div class="card">
            <div class="card-header">PD Controller Settings</div>
            <div class="control-group">
              <span class="control-label">Proportional Gain (Follow Strength)</span>
              <div class="control-input">
                <input type="number" class="input" id="kp" value="0.9" step="0.1"
                  onchange="sendToPython('set_kp', this.value)">
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Derivative Gain (Damping)</span>
              <div class="control-input">
                <input type="number" class="input" id="kd" value="0.3" step="0.1"
                  onchange="sendToPython('set_kd', this.value)">
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Maximum Correction Clamp</span>
              <div class="control-input">
                <input type="number" class="input" id="pdClamp" value="1.0" step="0.1"
                  onchange="sendToPython('set_pd_clamp', this.value)">
              </div>
            </div>
            <div class="help-hint">PD control maintains alignment between the fishing bar and target</div>
          </div>
          <div class="card">
            <div class="card-header">Advanced PD Parameters</div>
            <div class="control-group">
              <span class="control-label">Approaching Damping Factor</span>
              <div class="control-input">
                <input type="number" class="input" id="pdApproaching" value="2.0" step="0.1"
                  onchange="sendToPython('set_pd_approaching', this.value)">
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Chasing Damping Factor</span>
              <div class="control-input">
                <input type="number" class="input" id="pdChasing" value="0.5" step="0.1"
                  onchange="sendToPython('set_pd_chasing', this.value)">
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Gap Tolerance Multiplier</span>
              <div class="control-input">
                <input type="number" class="input" id="gapTolerance" value="2.0" step="0.1"
                  onchange="sendToPython('set_gap_tolerance', this.value)">
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">Casting Configuration</div>
            <div class="control-group">
              <span class="control-label">Cast Hold Duration</span>
              <div class="control-input">
                <input type="number" class="input" id="castHold" value="1.0" step="0.1"
                  onchange="sendToPython('set_cast_hold', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Recast Timeout</span>
              <div class="control-input">
                <input type="number" class="input" id="recastTimeout" value="30.0" step="1.0"
                  onchange="sendToPython('set_recast_timeout', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">Anti-Detection Thresholds</div>
            <div class="control-group">
              <span class="control-label">Black Screen Detection</span>
              <div class="control-input">
                <input type="number" class="input" id="blackThreshold" value="0.5" step="0.05"
                  onchange="sendToPython('set_black_threshold', this.value)">
                <span class="unit">%</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Key Spam Prevention Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="spamDelay" value="0.25" step="0.05"
                  onchange="sendToPython('set_spam_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
          </div>
        </div>

        <div class="view" id="timing">
          <div class="card">
            <div class="card-header">Core Timing Settings</div>
            <div class="control-group">
              <span class="control-label">Fish Completion Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="fishEndDelay" value="2.0" step="0.1"
                  onchange="sendToPython('set_fish_end_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">State Resend Interval</span>
              <div class="control-input">
                <input type="number" class="input" id="stateResend" value="0.5" step="0.05"
                  onchange="sendToPython('set_state_resend', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Scan Loop Frequency</span>
              <div class="control-input">
                <input type="number" class="input" id="scanDelay" value="0.1" step="0.01"
                  onchange="sendToPython('set_scan_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">Window Focus Timing</div>
            <div class="control-group">
              <span class="control-label">Initial Focus Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="focusDelay" value="0.2" step="0.1"
                  onchange="sendToPython('set_focus_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Post-Focus Stabilization</span>
              <div class="control-input">
                <input type="number" class="input" id="postFocusDelay" value="1.0" step="0.1"
                  onchange="sendToPython('set_post_focus_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">Purchase Interaction Timing</div>
            <div class="control-group">
              <span class="control-label">Interaction Key Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="preCastE" value="3.0" step="0.1"
                  onchange="sendToPython('set_precast_e_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Click Confirmation Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="preCastClick" value="3.0" step="0.1"
                  onchange="sendToPython('set_precast_click_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Typing Input Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="preCastType" value="3.0" step="0.1"
                  onchange="sendToPython('set_precast_type_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Humanization Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="antiDetect" value="0.05" step="0.01"
                  onchange="sendToPython('set_anti_detect_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">Inventory Selection Timing</div>
            <div class="control-group">
              <span class="control-label">Rod Selection Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="rodDelay" value="0.5" step="0.1"
                  onchange="sendToPython('set_rod_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Bait Selection Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="baitDelay" value="0.5" step="0.1"
                  onchange="sendToPython('set_bait_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Cursor Movement Humanization</span>
              <div class="control-input">
                <input type="number" class="input" id="cursorDelay" value="0.05" step="0.01"
                  onchange="sendToPython('set_cursor_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">Devil Fruit Storage Timing</div>
            <div class="control-group">
              <span class="control-label">Hotkey Press Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="fruitHotkey" value="1.0" step="0.1"
                  onchange="sendToPython('set_fruit_hotkey_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Click Interaction Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="fruitClick" value="2.0" step="0.1"
                  onchange="sendToPython('set_fruit_click_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Shift Key Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="fruitShift" value="0.5" step="0.1"
                  onchange="sendToPython('set_fruit_shift_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Backspace Input Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="fruitBackspace" value="1.5" step="0.1"
                  onchange="sendToPython('set_fruit_backspace_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">Crafting Timing</div>
            <div class="control-group">
              <span class="control-label">Menu Open Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="craftMenuDelay" value="0.85" step="0.05"
                  onchange="sendToPython('set_craft_menu_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">UI Click Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="craftClickDelay" value="0.5" step="0.05"
                  onchange="sendToPython('set_craft_click_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Recipe Selection Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="craftRecipeDelay" value="0.5" step="0.05"
                  onchange="sendToPython('set_craft_recipe_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Add Recipe Button Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="craftAddDelay" value="0.5" step="0.05"
                  onchange="sendToPython('set_craft_add_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Top Recipe Slot Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="craftTopDelay" value="0.5" step="0.05"
                  onchange="sendToPython('set_craft_top_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Craft Button Click Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="craftButtonDelay" value="0.025" step="0.005"
                  onchange="sendToPython('set_craft_button_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Close Menu Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="craftCloseDelay" value="0.5" step="0.05"
                  onchange="sendToPython('set_craft_close_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="help-hint">Fine-tune delays between crafting actions to prevent errors</div>
          </div>
        </div>

        <div class="view" id="settings">
          <div class="card">
            <div class="card-header">Configuration Management</div>
            <div class="control-group">
              <span class="control-label">Export Settings to File</span>
              <div class="control-input">
                <button class="btn btn-sm" onclick="sendToPython('export_settings', '')">Export Settings</button>
              </div>
            </div>
            <div class="help-hint">Save your current configuration to a file</div>

            <div class="control-group">
              <span class="control-label">Import Settings from File</span>
              <div class="control-input">
                <button class="btn btn-sm" onclick="sendToPython('import_settings', '')">Import Settings</button>
              </div>
            </div>
            <div class="help-hint">Load configuration from a previously exported file</div>

            <div class="control-group">
              <span class="control-label">Reset to Default Settings</span>
              <div class="control-input">
                <button class="btn btn-sm btn-secondary" onclick="confirmResetSettings()">Reset Settings</button>
              </div>
            </div>
            <div class="help-hint">This will erase all your current settings and restore defaults</div>
          </div>

          <div class="card">
          <div class="card-header">Application Information</div>
            <div class="control-group">
              <span class="control-label">Version</span>
              <div class="control-input">
                <span class="hotkey-badge"
                  style="background: linear-gradient(135deg, rgba(0, 255, 170, 0.2), rgba(0, 204, 136, 0.15)); border-color: rgba(0, 255, 170, 0.4); color: var(--success);">1.2.7</span>
              </div>
            </div>

            <div class="control-group">
              <span class="control-label">Build Hash</span>
              <div class="control-input">
                <span class="hotkey-badge"
                  style="font-size: 9px; letter-spacing: 0; background: rgba(22, 27, 38, 0.8);">a07966fb0aa36fd73bee0d8328d6e6eb</span>
              </div>
            </div>

            <div class="control-group">
              <span class="control-label">Configuration File</span>
              <div class="control-input">
                <button class="btn btn-sm btn-secondary" onclick="sendToPython('open_config_folder', '')">Open Config
                  Folder</button>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Debug Tools</div>
            <div class="control-group">
              <span class="control-label">View Current Configuration</span>
              <div class="control-input">
                <button class="btn btn-sm" onclick="sendToPython('view_config', '')">View Config JSON</button>
              </div>
            </div>

            <div class="control-group">
              <span class="control-label">Clear Cached Data</span>
              <div class="control-input">
                <button class="btn btn-sm btn-secondary" onclick="sendToPython('clear_cache', '')">Clear Cache</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="disclaimerModal" class="modal-overlay">
    <div class="modal-container">
      <div class="modal-header">
        <div class="modal-icon">âš ï¸</div>
        <h2>Important Notice</h2>
      </div>
      <div class="modal-body">
        <div class="disclaimer-section">
          <h3>Free & Open Source Software</h3>
          <p>This macro is <strong>completely free</strong> and made for public use. It should <strong>never be bought
              or resold</strong> to anyone under any circumstances.</p>
        </div>
        <div class="disclaimer-section">
          <h3>Creator Attribution</h3>
          <p>Created by <strong class="creator-name">KenNumi</strong></p>
          <p class="credit-notice">If you reproduce, modify, or redistribute this software, you must give proper credit
            to the original creator.</p>
        </div>
        <div class="disclaimer-section warning-box">
          <p><strong>Warning:</strong> Anyone charging money for this software is scamming you. Please report such
            incidents and obtain the macro from official sources only.</p>
        </div>
      </div>
      <div class="modal-footer">
        <label class="checkbox-container">
          <input type="checkbox" id="dontShowAgain">
          <span class="checkbox-label">Don't show this again</span>
        </label>
        <button class="btn btn-primary" onclick="closeDisclaimer()">I Understand</button>
      </div>
    </div>
  </div>

  <script>
    const CURRENT_VERSION = '1.2.7';
    const GITHUB_REPO = 'K3nD4rk-Code-Developer/Grand-Piece-Online-Fishing';
    const CLIENT_ID = getClientId();

    let activeCategoryIndex = 0;
    let activeSlideIndex = 0;
    let lastRenderedRecipes = null;
    let lastRenderedSessions = null;
    let pollInterval;

    const SLIDESHOW_DATA = [
      {
        label: "Setup",
        slides: [
          {
            url: "https://i.postimg.cc/SK3FDVrW/Water-Point.png",
            title: "Step 1 â€“ Launch & Configure",
            desc: "Open the macro and set your water target point first in the Locations tab."
          },
          {
            url: "https://i.postimg.cc/hvqFqjN2/Assign-Slots.png",
            title: "Step 2 â€“ Assign Hotkey Slots",
            desc: "Make sure your fishing rod is in the correct inventory slot, and your alternative slot too."
          },
        ]
      },
      {
        label: "Auto Craft",
        slides: [
          {
            url: "https://i.postimg.cc/QtYB62PL/Auto-Craft-Position.png",
            title: "Position Setup",
            desc: "Good in a good position where the interact with Blacksmith Sen is available, and you are close and have a clear sight of the water."
          },
          {
            url: "https://i.postimg.cc/LXj9Prpq/Auto-Craft-Left-DIalog.png",
            title: "Configure Left Dialog",
            desc: "Go to Locations tab, to Crafting Interface Points and configure."
          },
          {
            url: "https://i.postimg.cc/GtZxf8Nr/Middle-Dialog-Option.png",
            title: "Configure Middle Dialog",
            desc: "Go to Locations tab, to Crafting Interface Points and configure."
          },
          {
            url: "https://i.postimg.cc/qvHGXKyz/Add-Ingredient.png",
            title: "Configure Add Ingredient",
            desc: "Go to Locations tab, to Crafting Interface Points and configure."
          },
          {
            url: "https://i.postimg.cc/ZqTFXhf4/Top-Recipe-Slot.png",
            title: "Configure Top Recipe Slot",
            desc: "Go to Locations tab, to Crafting Interface Points and configure."
          },
          {
            url: "https://i.postimg.cc/wB0cpbZd/Click-Craft-Confirm.png",
            title: "Configure Click Craft Confirm",
            desc: "Go to Locations tab, to Crafting Interface Points and configure."
          },
          {
            url: "https://i.postimg.cc/k4GNXvPb/Menu-Close.png",
            title: "Configure Menu Close",
            desc: "Go to Locations tab, to Crafting Interface Points and configure."
          },
          {
            url: "https://i.postimg.cc/Xqyw9NJM/Add-and-Configure-Recipes.png",
            title: "Add and Configure Recipes",
            desc: "Go to Locations tab and click add recipe. Once you've done that, you may configure the location to be the location of the recipe on the craft menu."
          },
          {
            url: "https://i.postimg.cc/MGK3VRJ1/Add.png",
            title: "",
            desc: ""
          }
        ]
      },
      {
        label: "Auto Buy",
        slides: [
          {
            url: "https://i.postimg.cc/YqDzZP5R/Position.png",
            title: "Position Setup",
            desc: "Good in a good position where the interaction with Common Fish Bait Purchase is available."
          },
          {
            url: "https://i.postimg.cc/PrvjvgQP/Left-Dialog-Bait.png",
            title: "Configure Left Dialog",
            desc: "Go to Locations tab, to Bait Shop Interaction Points and configure."
          },
          {
            url: "https://i.postimg.cc/NjLp0t6S/Middle-Dialog-Bait.png",
            title: "Configure Middle Dialog",
            desc: "Go to Locations tab, to Bait Shop Interaction Points and configure."
          },
          {
            url: "https://i.postimg.cc/W1tX4VGY/Right-Dialog-Bait.png",
            title: "Configure Right Dialog",
            desc: "Go to Locations tab, to Bait Shop Interaction Points and configure."
          },
        ]
      },
      {
        label: "Auto Store",
        slides: [
          {
            url: "https://i.postimg.cc/cHccJwWf/Item-Store.png",
            title: "Set up the location for store",
            desc: ""
          },
        ]
      },
      {
        label: "Auto Select",
        slides: [
          {
            url: "https://i.postimg.cc/wjscmSH2/Select-Top-Bait.png",
            title: "Enable Auto Select",
            desc: "Toggle 'Auto Select Top Bait' in the Automation tab."
          }
        ]
      }
    ];

    function getClientId() {
      let clientId = localStorage.getItem('macroClientId');
      if (!clientId) {
        clientId = `client_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        localStorage.setItem('macroClientId', clientId);
      }
      return clientId;
    }

    async function regenerateClientId() {
      if (!confirm('This will generate a new Client ID and may disconnect this device from sync. Continue?')) {
        return;
      }

      localStorage.removeItem('macroClientId');
      const newClientId = getClientId();
      document.getElementById('clientIdDisplay').textContent = newClientId;

      try {
        await sendToPython('set_client_id', newClientId);
        showWarningNotification('Client ID regenerated. Please restart the macro.');
      } catch (error) {
        showErrorNotification('Failed to regenerate Client ID');
      }
    }

    function extractVersion(versionString) {
      const match = versionString.match(/(\d+)\.(\d+)\.(\d+)/);
      if (match) {
        return match[0];
      }
      return versionString;
    }

    function compareVersions(v1, v2) {
      const version1 = extractVersion(v1);
      const version2 = extractVersion(v2);

      const parts1 = version1.split('.').map(Number);
      const parts2 = version2.split('.').map(Number);

      for (let i = 0; i < Math.max(parts1.length, parts2.length); i++) {
        const part1 = parts1[i] || 0;
        const part2 = parts2[i] || 0;

        if (part1 > part2) return 1;
        if (part1 < part2) return -1;
      }

      return 0;
    }

    async function checkForUpdates() {
      try {
        const response = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/releases/latest`);

        if (!response.ok) {
          return;
        }

        const data = await response.json();
        const latestVersionRaw = data.tag_name;
        const latestVersion = extractVersion(latestVersionRaw);

        if (compareVersions(latestVersion, CURRENT_VERSION) > 0) {
          showUpdateBanner(latestVersion, data.html_url);
        }

      } catch (error) {
        console.error('Error checking for updates:', error);
      }
    }

    function showUpdateBanner(newVersion, downloadUrl) {
      const banner = document.getElementById('updateBanner');
      const versionText = document.getElementById('newVersionText');

      if (banner && versionText) {
        versionText.textContent = `v${newVersion}`;
        banner.style.display = 'block';
        window.latestReleaseUrl = downloadUrl;
      }
    }

    async function downloadUpdate() {
      const url = window.latestReleaseUrl || `https://github.com/${GITHUB_REPO}/releases/latest`;

      try {
        await fetch('http://localhost:8765/command', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'open_browser',
            payload: url,
            clientId: CLIENT_ID
          })
        });
      } catch (error) {
        console.error('Failed to open browser:', error);
        window.location.href = url;
      }
    }

    function dismissBanner() {
      const banner = document.getElementById('updateBanner');
      if (banner) {
        banner.style.animation = 'slideUp 0.3s ease-out';
        setTimeout(() => {
          banner.style.display = 'none';
        }, 300);
      }
    }

    function checkDisclaimer() {
      const hideDisclaimer = localStorage.getItem('hideDisclaimer');
      const modal = document.getElementById('disclaimerModal');
      if (hideDisclaimer === 'true') {
        modal.style.display = 'none';
      } else {
        modal.style.display = 'flex';
      }
    }

    function closeDisclaimer() {
      const dontShowAgain = document.getElementById('dontShowAgain').checked;
      if (dontShowAgain) {
        localStorage.setItem('hideDisclaimer', 'true');
      }
      document.getElementById('disclaimerModal').style.display = 'none';
    }

    function showWarningNotification(message) {
      const notification = document.createElement('div');
      notification.style.cssText = 'position:fixed;top:80px;right:20px;background:linear-gradient(135deg,rgba(255,170,0,0.95),rgba(245,158,11,0.95));color:#111;padding:16px 24px;border-radius:12px;font-weight:600;font-size:14px;box-shadow:0 8px 32px rgba(255,170,0,0.4);z-index:10000;animation:slideInRight 0.3s ease-out;border:1px solid rgba(255,255,255,0.2);max-width:400px;word-wrap:break-word;';
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.3s ease-out';
        setTimeout(() => notification.remove(), 300);
      }, 5000);
    }

    function showErrorNotification(message) {
      const notification = document.createElement('div');
      notification.style.cssText = 'position:fixed;top:80px;right:20px;background:linear-gradient(135deg,rgba(255,68,102,0.95),rgba(220,38,38,0.95));color:white;padding:16px 24px;border-radius:12px;font-weight:600;font-size:14px;box-shadow:0 8px 32px rgba(255,68,102,0.4);z-index:10000;animation:slideInRight 0.3s ease-out;border:1px solid rgba(255,255,255,0.2);max-width:400px;word-wrap:break-word;';
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.3s ease-out';
        setTimeout(() => notification.remove(), 300);
      }, 5000);
    }

    function updateRdpIndicator(isRdp, sessionState) {
      const indicator = document.getElementById('rdpIndicator');
      const text = document.getElementById('rdpText');
      const sessionTypeIndicator = document.getElementById('sessionTypeIndicator');
      const sessionTypeText = document.getElementById('sessionTypeText');

      if (isRdp) {
        indicator.classList.add('active');
        text.textContent = sessionState === 'connected' ? 'RDP Active' : 'RDP Disconnected';

        if (sessionTypeIndicator) {
          sessionTypeIndicator.classList.add('active');
          sessionTypeText.textContent = 'Remote Desktop Protocol';
        }
      } else {
        indicator.classList.remove('active');
        text.textContent = 'Local Session';

        if (sessionTypeText) {
          sessionTypeText.textContent = 'Local Desktop';
        }
      }
    }

    function formatUptime(seconds) {
      if (seconds < 60) return `${Math.floor(seconds)}s`;
      if (seconds < 3600) return `${Math.floor(seconds / 60)}m`;
      return `${Math.floor(seconds / 3600)}h`;
    }

    function renderConnectedDevices(devices) {
      const container = document.getElementById('devicesContainer');
      if (!container) return;

      if (!devices || devices.length === 0) {
        container.innerHTML = '<div style="text-align:center;padding:20px;color:var(--text-muted);">No devices connected. Enable device synchronization to see connected devices.</div>';
        return;
      }

      container.innerHTML = '';
      devices.forEach((device, index) => {
        const isOnline = device.last_seen && (Date.now() - device.last_seen * 1000) < 30000;
        const deviceCard = document.createElement('div');
        deviceCard.className = 'device-card';
        deviceCard.innerHTML = `
      <div class="device-header">
        <div class="device-name">
          <i class="fas fa-desktop"></i> ${device.name || `Device ${index + 1}`}
        </div>
        <div class="device-status ${isOnline ? '' : 'offline'}">
          <div style="width: 6px; height: 6px; border-radius: 50%; background: currentColor;"></div>
          ${isOnline ? 'Online' : 'Offline'}
        </div>
      </div>
      <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 8px;">
        ID: ${device.client_id}
      </div>
      <div class="device-stats">
        <div class="device-stat">
          <div class="device-stat-label">Fish Caught</div>
          <div class="device-stat-value">${device.fish_caught || 0}</div>
        </div>
        <div class="device-stat">
          <div class="device-stat-label">Uptime</div>
          <div class="device-stat-value">${formatUptime(device.uptime || 0)}</div>
        </div>
        <div class="device-stat">
          <div class="device-stat-label">Status</div>
          <div class="device-stat-value" style="font-size: 12px;">${device.is_running ? 'Active' : 'Idle'}</div>
        </div>
      </div>
    `;
        container.appendChild(deviceCard);
      });
    }

    function buildSlideshow() {
      const tabsEl = document.getElementById('slideshowTabs');
      const viewEl = document.getElementById('slideshowViewport');
      const dotsEl = document.getElementById('slideDots');

      tabsEl.innerHTML = '';
      SLIDESHOW_DATA.forEach((cat, ci) => {
        const btn = document.createElement('button');
        btn.className = 'slideshow-tab' + (ci === 0 ? ' active' : '');
        btn.textContent = cat.label;
        btn.onclick = () => switchCategory(ci);
        tabsEl.appendChild(btn);
      });

      const prevBtn = viewEl.querySelector('.slide-nav.prev');
      const nextBtn = viewEl.querySelector('.slide-nav.next');

      viewEl.querySelectorAll('.slide').forEach(s => s.remove());

      SLIDESHOW_DATA.forEach((cat, ci) => {
        cat.slides.forEach((slide, si) => {
          const div = document.createElement('div');
          div.className = 'slide';
          div.id = `slide-${ci}-${si}`;
          if (ci === 0 && si === 0) div.classList.add('visible');

          div.innerHTML = `
          <img src="${slide.url}" alt="${slide.title || 'Guide image'}">
          <div class="slide-overlay">
            <div class="slide-overlay-inner">
              ${slide.title ? `<div class="slide-overlay-title">${slide.title}</div>` : ''}
              ${slide.desc ? `<div class="slide-overlay-desc">${slide.desc}</div>` : ''}
            </div>
          </div>`;

          viewEl.insertBefore(div, prevBtn);
        });
      });

      rebuildDots();

      prevBtn.onclick = () => goToSlide(activeSlideIndex - 1);
      nextBtn.onclick = () => goToSlide(activeSlideIndex + 1);
    }

    function rebuildDots() {
      const dotsEl = document.getElementById('slideDots');
      dotsEl.innerHTML = '';
      const count = SLIDESHOW_DATA[activeCategoryIndex].slides.length;
      for (let i = 0; i < count; i++) {
        const dot = document.createElement('div');
        dot.className = 'slide-dot' + (i === activeSlideIndex ? ' active' : '');
        dot.onclick = () => goToSlide(i);
        dotsEl.appendChild(dot);
      }
    }

    function switchCategory(ci) {
      document.querySelectorAll('.slideshow-tab').forEach((t, i) => {
        t.classList.toggle('active', i === ci);
      });
      activeCategoryIndex = ci;
      activeSlideIndex = 0;
      showCurrentSlide();
      rebuildDots();
    }

    function goToSlide(idx) {
      const slides = SLIDESHOW_DATA[activeCategoryIndex].slides;
      if (idx < 0) idx = slides.length - 1;
      if (idx >= slides.length) idx = 0;
      activeSlideIndex = idx;
      showCurrentSlide();
      rebuildDots();
    }

    function showCurrentSlide() {
      SLIDESHOW_DATA.forEach((cat, ci) => {
        cat.slides.forEach((slide, si) => {
          const slideEl = document.getElementById(`slide-${ci}-${si}`);
          if (slideEl) {
            slideEl.classList.remove('visible');
          }
        });
      });

      const target = document.getElementById(`slide-${activeCategoryIndex}-${activeSlideIndex}`);
      if (target) {
        target.classList.add('visible');
      }
    }

    function renderDevilFruitSlotSelector(selectedSlots) {
      const container = document.getElementById('devilFruitSlotSelector');
      if (!container) {
        setTimeout(() => renderDevilFruitSlotSelector(selectedSlots), 100);
        return;
      }
      if (!selectedSlots || !Array.isArray(selectedSlots)) selectedSlots = ['3'];
      container.innerHTML = '';
      for (let i = 0; i <= 9; i++) {
        const button = document.createElement('button');
        button.className = 'btn btn-sm slot-button';
        button.textContent = i.toString();
        const isSelected = selectedSlots.includes(i.toString());
        if (isSelected) {
          button.style.cssText = 'min-width:40px;padding:8px 12px;background:linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));border-color:var(--accent-primary);box-shadow:0 4px 15px rgba(0, 217, 255, 0.4);';
        } else {
          button.style.cssText = 'min-width:40px;padding:8px 12px;background:rgba(22, 27, 38, 0.8);box-shadow:none;border:1px solid var(--border-subtle);';
        }
        button.onclick = () => toggleDevilFruitSlot(i.toString());
        container.appendChild(button);
      }
    }

    function toggleDevilFruitSlot(slot) {
      const rodSlot = document.getElementById('rodHotkey').value;
      const secondarySlot = document.getElementById('anythingElseHotkey').value;

      if (slot === rodSlot) {
        showWarningNotification(`Slot ${slot} is already used by the Fishing Rod!`);
        return;
      }

      if (slot === secondarySlot) {
        showWarningNotification(`Slot ${slot} is already used by the Secondary Item!`);
        return;
      }

      let currentSlots = window.currentDevilFruitSlots || ['3'];
      if (currentSlots.includes(slot)) {
        currentSlots = currentSlots.filter(s => s !== slot);
      } else {
        currentSlots.push(slot);
      }
      if (currentSlots.length === 0) currentSlots = ['3'];
      window.currentDevilFruitSlots = currentSlots;
      renderDevilFruitSlotSelector(currentSlots);
      sendToPython('set_devil_fruit_hotkeys', currentSlots.join(','));
    }

    function validateAndSetRodSlot(value) {
      const secondarySlot = document.getElementById('anythingElseHotkey').value;
      const devilFruitSlots = window.currentDevilFruitSlots || ['3'];

      if (value === secondarySlot) {
        showWarningNotification(`Slot ${value} is already used by the Secondary Item!`);
        document.getElementById('rodHotkey').value = window.lastValidRodSlot || '1';
        return;
      }

      if (devilFruitSlots.includes(value)) {
        showWarningNotification(`Slot ${value} is already used by Devil Fruit slots!`);
        document.getElementById('rodHotkey').value = window.lastValidRodSlot || '1';
        return;
      }

      window.lastValidRodSlot = value;
      sendToPython('set_rod_hotkey', value);
    }

    function validateAndSetSecondarySlot(value) {
      const rodSlot = document.getElementById('rodHotkey').value;
      const devilFruitSlots = window.currentDevilFruitSlots || ['3'];

      if (value === rodSlot) {
        showWarningNotification(`Slot ${value} is already used by the Fishing Rod!`);
        document.getElementById('anythingElseHotkey').value = window.lastValidSecondarySlot || '2';
        return;
      }

      if (devilFruitSlots.includes(value)) {
        showWarningNotification(`Slot ${value} is already used by Devil Fruit slots!`);
        document.getElementById('anythingElseHotkey').value = window.lastValidSecondarySlot || '2';
        return;
      }

      window.lastValidSecondarySlot = value;
      sendToPython('set_anything_else_hotkey', value);
    }

    function toggleExpandable(settingName, expandId) {
      const toggle = document.getElementById(`${settingName}Toggle`);
      const section = document.getElementById(expandId);
      const willBeActive = !toggle.classList.contains('active');

      toggle.classList.toggle('active');
      const isActive = toggle.classList.contains('active');
      if (isActive) {
        section.classList.add('expanded');
      } else {
        section.classList.remove('expanded');
      }
      sendToPython(`toggle_${settingName.replace(/([A-Z])/g, '_$1').toLowerCase()}`, isActive.toString());
    }

    function toggleSetting(settingName) {
      const toggle = document.getElementById(`${settingName}Toggle`);
      const willBeActive = !toggle.classList.contains('active');

      toggle.classList.toggle('active');
      const isActive = toggle.classList.contains('active');
      sendToPython(`toggle_${settingName.replace(/([A-Z])/g, '_$1').toLowerCase()}`, isActive.toString());
    }

    function checkRequirements(settingName) {
      const warningId = `${settingName}Warning`;
      const warningEl = document.getElementById(warningId);
      const toggleEl = document.getElementById(`${settingName}Toggle`);

      if (!warningEl) return true;

      const isToggled = toggleEl && toggleEl.classList.contains('active');

      let missingRequirements = false;
      let message = '<strong>âš ï¸ Missing Requirements:</strong><br>';

      if (settingName === 'autoStoreFruit') {
        const storeFruitStatus = document.getElementById('storeFruitPointStatus');
        if (storeFruitStatus && storeFruitStatus.classList.contains('unset')) {
          missingRequirements = true;
          message += 'Configure Devil Fruit Store location in <a onclick="navigateToLocations()">Locations â†’ Devil Fruit Locations</a>';
        }
      }

      if (settingName === 'autoBuyBait') {
        const leftStatus = document.getElementById('leftPointStatus');
        const middleStatus = document.getElementById('middlePointStatus');
        const rightStatus = document.getElementById('rightPointStatus');

        const missing = [];
        if (leftStatus && leftStatus.classList.contains('unset')) missing.push('Left Dialog');
        if (middleStatus && middleStatus.classList.contains('unset')) missing.push('Middle Dialog');
        if (rightStatus && rightStatus.classList.contains('unset')) missing.push('Right Dialog');

        if (missing.length > 0) {
          missingRequirements = true;
          message += `Configure ${missing.join(', ')} in <a onclick="navigateToLocations()">Locations â†’ Bait Shop Interaction Points</a>`;
        }
      }

      if (settingName === 'autoCraftBait') {
        const points = {
          'craftLeftPointStatus': 'Left Dialog',
          'craftMiddlePointStatus': 'Middle Dialog',
          'craftButtonPointStatus': 'Craft Confirm',
          'closeMenuPointStatus': 'Menu Close',
          'addRecipePointStatus': 'Add Recipe',
          'topRecipePointStatus': 'Top Recipe Slot'
        };

        const missing = [];
        for (const [id, name] of Object.entries(points)) {
          const status = document.getElementById(id);
          if (status && status.classList.contains('unset')) missing.push(name);
        }

        if (missing.length > 0) {
          missingRequirements = true;
          message += `Configure ${missing.join(', ')} in <a onclick="navigateToLocations()">Locations â†’ Crafting Interface Points</a>`;
        }

        const recipesContainer = document.getElementById('RecipesContainer');
        if (!recipesContainer || recipesContainer.children.length === 0 ||
          recipesContainer.textContent.includes('No recipes configured')) {
          if (!missingRequirements) {
            missingRequirements = true;
            message += 'Add at least one bait recipe in <a onclick="navigateToLocations()">Locations â†’ Crafting Recipes</a>';
          } else {
            message += '<br>Also add at least one bait recipe in <a onclick="navigateToLocations()">Locations â†’ Crafting Recipes</a>';
          }
        }
      }

      if (settingName === 'autoSelectBait') {
        const baitStatus = document.getElementById('baitPointStatus');
        if (baitStatus && baitStatus.classList.contains('unset')) {
          missingRequirements = true;
          message += 'Configure Top Bait Point in <a onclick="navigateToLocations()">Locations â†’ Bait Locations</a>';
        }
      }

      if (isToggled && missingRequirements) {
        warningEl.innerHTML = message;
        warningEl.classList.add('show');
      } else {
        warningEl.classList.remove('show');
      }

      return !missingRequirements;
    }

    function navigateToLocations() {
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
      document.querySelector('[data-view="locations"]').classList.add('active');
      document.getElementById('locations').classList.add('active');
    }

    async function addNewRecipe() {
      try {
        const response = await fetch('http://localhost:8765/add_recipe', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        });
        const result = await response.json();
        if (result.status === 'success') {
          lastRenderedRecipes = null;
          await pollPythonState();
        }
      } catch (error) {
        console.error('Failed to add recipe:', error);
      }
    }

    async function removeRecipe(recipeIndex) {
      try {
        await fetch('http://localhost:8765/remove_recipe', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ index: recipeIndex })
        });
        await pollPythonState();
      } catch (error) {
        console.error('Failed to remove recipe:', error);
      }
    }

    async function testWebhook() {
      const webhookUrl = document.getElementById('webhookUrl').value;
      if (!webhookUrl || !webhookUrl.trim()) {
        showErrorNotification('Please enter a Webhook URL First.');
        return;
      }

      try {
        const response = await fetch('http://localhost:8765/command', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'test_webhook',
            payload: '',
            clientId: CLIENT_ID
          })
        });

        const result = await response.json();
        if (result.status != "success") {
          showErrorNotification(`Webhook test failed: ${result.message}`);
        }
      } catch (error) {
        showErrorNotification('Failed to send test webhook.');
      }
    }

    async function setRecipePoint(recipeIndex, pointType) {
      try {
        await fetch('http://localhost:8765/set_recipe_point', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ recipeIndex: recipeIndex, pointType: pointType })
        });
      } catch (error) {
        console.error('Failed to set recipe point:', error);
      }
    }

    async function updateRecipeValue(recipeIndex, fieldName, value) {
      try {
        await fetch('http://localhost:8765/update_recipe_value', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            recipeIndex: recipeIndex,
            fieldName: fieldName,
            value: parseInt(value)
          })
        });
      } catch (error) {
        console.error('Failed to update recipe value:', error);
      }
    }

    function renderRecipes(recipes) {
      const container = document.getElementById('RecipesContainer');
      if (!container) return;
      if (JSON.stringify(recipes) === JSON.stringify(lastRenderedRecipes)) return;
      lastRenderedRecipes = JSON.parse(JSON.stringify(recipes));
      container.innerHTML = '';
      if (recipes.length === 0) {
        container.innerHTML = '<div style="text-align:center;padding:20px;color:var(--text-muted);">No recipes configured. Click "+ Add Recipe" to get started.</div>';
        return;
      }
      recipes.forEach((recipe, index) => {
        const recipeDiv = document.createElement('div');
        recipeDiv.className = 'recipe-item';
        recipeDiv.style.cssText = 'border:1px solid var(--border-subtle);border-radius:12px;padding:18px;margin-bottom:14px;background:linear-gradient(135deg, rgba(26, 32, 48, 0.5), rgba(22, 27, 38, 0.5));transition:all 0.3s ease;backdrop-filter:blur(10px);';
        recipeDiv.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;">
        <strong style="background:linear-gradient(135deg, var(--accent-primary), var(--accent-tertiary));-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;font-size:14px;">Recipe ${index + 1}</strong>
        <button class="btn btn-sm btn-secondary" onclick="removeRecipe(${index})">Remove</button>
      </div>
      <div class="control-group">
        <span class="control-label">Bait Recipe Selection</span>
        <div class="control-input">
          <span class="point-indicator ${recipe.BaitRecipePoint ? 'set' : 'unset'}">
            ${recipe.BaitRecipePoint ? `X: ${recipe.BaitRecipePoint.x}, Y: ${recipe.BaitRecipePoint.y}` : 'Not Configured'}
          </span>
          <button class="btn btn-sm" onclick="setRecipePoint(${index}, 'BaitRecipePoint')">Configure</button>
        </div>
      </div>
      <div class="control-group">
        <span class="control-label">Amount of Crafts</span>
        <div class="control-input">
          <input type="number" class="input" value="${recipe.CraftsPerCycle || 40}" step="1" onchange="updateRecipeValue(${index}, 'CraftsPerCycle', this.value)">
        </div>
      </div>
      <div class="control-group">
        <span class="control-label">Switch Fish Cycle</span>
        <div class="control-input">
          <input type="number" class="input" value="${recipe.SwitchFishCycle || 5}" step="1" onchange="updateRecipeValue(${index}, 'SwitchFishCycle', this.value)">
        </div>
      </div>`;
        container.appendChild(recipeDiv);
      });
    }

    async function sendToPython(action, payload) {
      try {
        console.log('Sending to Python:', action, payload);
        const response = await fetch('http://localhost:8765/command', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action, payload })
        });
        const result = await response.json();
        if (result.status === 'error') {
          showErrorNotification(`Error: ${result.message}`);
        }
      } catch (error) {
        console.error('Failed to send to Python:', error);
        showErrorNotification(`Connection failed: ${error.message}`);
      }
    }

    function confirmResetSettings() {
      if (confirm('âš ï¸ WARNING: This will reset ALL settings to their default values.\n\nThis action cannot be undone. Are you sure you want to continue?')) {
        if (confirm('Really reset everything? Click OK to confirm.')) {
          sendToPython('reset_settings', 'confirm');
        }
      }
    }

    function updateStatus(isRunning) {
      const dot = document.getElementById('statusDot');
      const text = document.getElementById('statusText');
      if (isRunning) {
        dot.classList.add('active');
        text.textContent = 'Active';
      } else {
        dot.classList.remove('active');
        text.textContent = 'Inactive';
      }
    }

    function updateHotkey(key, value) {
      const element = document.getElementById(`hotkey-${key}`);
      if (element) element.textContent = value.toUpperCase();
    }

    function updatePointStatus(pointName, x, y) {
      const status = document.getElementById(`${pointName}Status`);
      if (!status) {
        console.warn(`Point status element not found: ${pointName}Status`);
        return;
      }
      if (x !== null && y !== null && x !== undefined && y !== undefined) {
        status.textContent = `X: ${x}, Y: ${y}`;
        status.classList.remove('unset');
        status.classList.add('set');
      } else {
        status.textContent = 'Not Configured';
        status.classList.remove('set');
        status.classList.add('unset');
      }
    }

    function setInputValue(elementId, value) {
      const element = document.getElementById(elementId);
      if (!element) {
        console.warn(`Element not found: ${elementId}`);
        return;
      }

      if (document.activeElement === element) {
        return;
      }

      if (element.type === 'number' || element.tagName === 'INPUT') {
        element.value = value;
      } else if (element.tagName === 'SELECT') {
        element.value = value;
      }
    }

    function setToggleState(elementId, isActive) {
      const element = document.getElementById(elementId);
      if (!element) {
        console.warn(`Toggle element not found: ${elementId}`);
        return;
      }
      if (isActive) {
        element.classList.add('active');
      } else {
        element.classList.remove('active');
      }
    }

    function setExpandableSection(toggleId, expandId, isActive) {
      const toggle = document.getElementById(toggleId);
      const section = document.getElementById(expandId);
      if (!toggle || !section) {
        console.warn(`Expandable section not found: ${toggleId} or ${expandId}`);
        return;
      }
      if (isActive) {
        toggle.classList.add('active');
        section.classList.add('expanded');
      } else {
        toggle.classList.remove('active');
        section.classList.remove('expanded');
      }
    }

    function loadAllSettings(state) {
      console.log('Loading all settings from state:', state);

      if (state.hotkeys) {
        updateHotkey('start', state.hotkeys.start_stop || 'f1');
        updateHotkey('exit', state.hotkeys.exit || 'f3');
      }

      setInputValue('rodHotkey', state.rodHotkey || '1');
      setInputValue('anythingElseHotkey', state.anythingElseHotkey || '2');

      let dfSlots = state.devilFruitHotkeys || state.devilFruitHotkey || ['3'];
      if (!Array.isArray(dfSlots)) dfSlots = [dfSlots];
      window.currentDevilFruitSlots = dfSlots;
      setTimeout(() => renderDevilFruitSlotSelector(dfSlots), 100);

      setToggleState('alwaysOnTopToggle', state.alwaysOnTop);
      setToggleState('debugOverlayToggle', state.showDebugOverlay);
      setToggleState('megalodonSoundToggle', state.megalodonSoundEnabled);
      setInputValue('soundSensitivity', state.soundSensitivity || 0.7);

      setExpandableSection('autoBuyBaitToggle', 'autoBuyExpand', state.autoBuyCommonBait);
      setExpandableSection('autoCraftBaitToggle', 'autoCraftExpand', state.autoCraftBait);
      setExpandableSection('autoStoreFruitToggle', 'autoStoreExpand', state.autoStoreDevilFruit);
      setToggleState('autoSelectBaitToggle', state.autoSelectTopBait);
      setToggleState('storeToBackpackToggle', state.storeToBackpack);

      setInputValue('kp', state.kp);
      setInputValue('kd', state.kd);
      setInputValue('pdClamp', state.pdClamp);
      setInputValue('pdApproaching', state.pdApproachingDamping);
      setInputValue('pdChasing', state.pdChasingDamping);
      setInputValue('gapTolerance', state.gapToleranceMultiplier);

      setInputValue('castHold', state.castHoldDuration);
      setInputValue('recastTimeout', state.recastTimeout);
      setInputValue('fishEndDelay', state.fishEndDelay);
      setInputValue('stateResend', state.stateResendInterval);
      setInputValue('loopsPerPurchase', state.loopsPerPurchase);
      setInputValue('loopsPerStore', state.loopsPerStore);
      setInputValue('craftsPerCycle', state.craftsPerCycle);
      setInputValue('loopsPerCraft', state.loopsPerCraft);
      setInputValue('moveDuration', state.moveDuration);
      setInputValue('fishCountPerCraft', state.fishCountPerCraft);

      setInputValue('focusDelay', state.robloxFocusDelay);
      setInputValue('postFocusDelay', state.robloxPostFocusDelay);
      setInputValue('preCastE', state.preCastEDelay);
      setInputValue('preCastClick', state.preCastClickDelay);
      setInputValue('preCastType', state.preCastTypeDelay);
      setInputValue('antiDetect', state.preCastAntiDetectDelay);
      setInputValue('fruitHotkey', state.storeFruitHotkeyDelay);
      setInputValue('fruitClick', state.storeFruitClickDelay);
      setInputValue('fruitShift', state.storeFruitShiftDelay);
      setInputValue('fruitBackspace', state.storeFruitBackspaceDelay);
      setInputValue('rodDelay', state.rodSelectDelay);
      setInputValue('baitDelay', state.autoSelectBaitDelay);
      setInputValue('cursorDelay', state.cursorAntiDetectDelay);
      setInputValue('scanDelay', state.scanLoopDelay);
      setInputValue('blackThreshold', state.blackScreenThreshold);
      setInputValue('spamDelay', state.antiMacroSpamDelay);
      setInputValue('craftMenuDelay', state.craftMenuOpenDelay);
      setInputValue('craftClickDelay', state.craftClickDelay);
      setInputValue('craftRecipeDelay', state.craftRecipeSelectDelay);

      updatePointStatus('waterPoint', state.waterPoint?.x, state.waterPoint?.y);
      updatePointStatus('leftPoint', state.leftPoint?.x, state.leftPoint?.y);
      updatePointStatus('middlePoint', state.middlePoint?.x, state.middlePoint?.y);
      updatePointStatus('rightPoint', state.rightPoint?.x, state.rightPoint?.y);
      updatePointStatus('storeFruitPoint', state.storeFruitPoint?.x, state.storeFruitPoint?.y);
      updatePointStatus('baitPoint', state.baitPoint?.x, state.baitPoint?.y);
      updatePointStatus('craftLeftPoint', state.craftLeftPoint?.x, state.craftLeftPoint?.y);
      updatePointStatus('craftMiddlePoint', state.craftMiddlePoint?.x, state.craftMiddlePoint?.y);
      updatePointStatus('baitRecipePoint', state.baitRecipePoint?.x, state.baitRecipePoint?.y);
      updatePointStatus('topRecipePoint', state.topRecipePoint?.x, state.topRecipePoint?.y);
      updatePointStatus('craftButtonPoint', state.craftButtonPoint?.x, state.craftButtonPoint?.y);
      updatePointStatus('closeMenuPoint', state.closeMenuPoint?.x, state.closeMenuPoint?.y);
      updatePointStatus('addRecipePoint', state.addRecipePoint?.x, state.addRecipePoint?.y);
      updatePointStatus('devilFruitLocationPoint', state.devilFruitLocationPoint?.x, state.devilFruitLocationPoint?.y);

      setInputValue('webhookUrl', state.webhookUrl || '');
      setToggleState('logDevilFruitToggle', state.logDevilFruit || false);
      setToggleState('logRecastTimeoutsToggle', state.logRecastTimeouts);
      setToggleState('logPeriodicStatsToggle', state.logPeriodicStats);
      setToggleState('logGeneralUpdatesToggle', state.logGeneralUpdates);
      setToggleState('webhookPingToggle', state.webhookPing || false);
      setInputValue('periodicStatsInterval', state.periodicStatsInterval || 5);

      if (state.baitRecipes !== undefined) renderRecipes(state.baitRecipes);

      console.log('All settings loaded successfully');
    }

    async function loadInitialSettings() {
      try {
        const response = await fetch('http://localhost:8765/state');
        const state = await response.json();
        console.log('Loaded initial state:', state);
        loadAllSettings(state);
      } catch (error) {
        console.error('Failed to load initial settings:', error);
      }
    }

    function renderActiveSessions(sessions) {
      const container = document.getElementById('activeSessionsContainer');
      if (!container) return;

      const sessionKey = sessions ? sessions.map(s =>
        `${s.client_id}-${s.session_id}-${s.is_running}`
      ).join('|') : 'empty';

      if (sessionKey === window.lastSessionKey) return;
      window.lastSessionKey = sessionKey;

      if (!sessions || sessions.length === 0) {
        container.innerHTML = '<div style="text-align:center;padding:20px;color:var(--text-muted);">No active sessions detected</div>';
        return;
      }

      container.innerHTML = '';
      sessions.forEach(session => {
        const isCurrentClient = session.client_id === CLIENT_ID;
        const sessionCard = document.createElement('div');
        sessionCard.className = 'device-card';
        sessionCard.style.borderColor = isCurrentClient ? 'var(--border-accent)' : 'var(--border-subtle)';

        sessionCard.innerHTML = `
    <div class="device-header">
        <div class="device-name">
            ${isCurrentClient ? '<strong>This Device</strong>' : `Session ${session.session_id}`}
        </div>
        <div class="device-status ${session.is_running ? '' : 'offline'}">
            <div style="width: 6px; height: 6px; border-radius: 50%; background: currentColor;"></div>
            ${session.is_running ? 'Running' : 'Idle'}
        </div>
    </div>
    <div style="font-size: 10px; color: var(--text-muted); margin-top: 8px;">
        Client ID: ${session.client_id.substring(0, 16)}...
    </div>
    ${session.rdp_detected ? `
        <div style="margin-top: 8px;">
            <div class="rdp-indicator active">
                <div class="rdp-dot"></div>
                <span>RDP ${session.rdp_state}</span>
            </div>
        </div>
    ` : ''}
  `;
        container.appendChild(sessionCard);
      });
    }

    async function pollPythonState() {
      try {
        const response = await fetch(`http://localhost:8765/state?clientId=${CLIENT_ID}`);
        const state = await response.json();

        const isThisClientActive = state.currentActiveClientId === CLIENT_ID && state.isRunning;
        updateStatus(isThisClientActive);

        if (state.activeSessions) {
          renderActiveSessions(state.activeSessions);
        }

        if (state.rdp_detected !== undefined) {
          updateRdpIndicator(state.rdp_detected, state.rdp_session_state);
        }

        if (state.connected_devices) {
          renderConnectedDevices(state.connected_devices);
        }

        if (state.is_syncing) {
          const syncStatus = document.getElementById('syncStatus');
          if (syncStatus) syncStatus.style.display = 'flex';
        } else {
          const syncStatus = document.getElementById('syncStatus');
          if (syncStatus) syncStatus.style.display = 'none';
        }

        if (state.device_name && document.getElementById('deviceName')) {
          document.getElementById('deviceName').value = state.device_name;
        }

        if (state.megalodonSoundEnabled !== undefined) {
          setToggleState('megalodonSoundToggle', state.megalodonSoundEnabled);
        }
        if (state.soundSensitivity !== undefined) {
          setInputValue('soundSensitivity', state.soundSensitivity);
        }

        if (document.getElementById('clientIdDisplay')) {
          document.getElementById('clientIdDisplay').textContent = CLIENT_ID;
        }

        setToggleState('autoDetectRdpToggle', state.auto_detect_rdp !== false);

        setToggleState('enableDeviceSyncToggle', state.enable_device_sync || false);
        setExpandableSection('enableDeviceSyncToggle', 'deviceSyncExpand', state.enable_device_sync || false);
        setToggleState('syncSettingsToggle', state.sync_settings !== false);
        setToggleState('syncStatsToggle', state.sync_stats !== false);
        setToggleState('sharesFishCountToggle', state.share_fish_count || false);

        if (state.sync_interval && document.getElementById('syncInterval')) {
          document.getElementById('syncInterval').value = state.sync_interval;
        }

        if (state.baitRecipes !== undefined) renderRecipes(state.baitRecipes);

        updatePointStatus('waterPoint', state.waterPoint?.x, state.waterPoint?.y);
        updatePointStatus('leftPoint', state.leftPoint?.x, state.leftPoint?.y);
        updatePointStatus('middlePoint', state.middlePoint?.x, state.middlePoint?.y);
        updatePointStatus('rightPoint', state.rightPoint?.x, state.rightPoint?.y);
        updatePointStatus('storeFruitPoint', state.storeFruitPoint?.x, state.storeFruitPoint?.y);
        updatePointStatus('baitPoint', state.baitPoint?.x, state.baitPoint?.y);
        updatePointStatus('craftLeftPoint', state.craftLeftPoint?.x, state.craftLeftPoint?.y);
        updatePointStatus('craftMiddlePoint', state.craftMiddlePoint?.x, state.craftMiddlePoint?.y);
        updatePointStatus('closeMenuPoint', state.closeMenuPoint?.x, state.closeMenuPoint?.y);
        updatePointStatus('devilFruitLocationPoint', state.devilFruitLocationPoint?.x, state.devilFruitLocationPoint?.y);
        updatePointStatus('craftButtonPoint', state.craftButtonPoint?.x, state.craftButtonPoint?.y);
        updatePointStatus('addRecipePoint', state.addRecipePoint?.x, state.addRecipePoint?.y);
        updatePointStatus('topRecipePoint', state.topRecipePoint?.x, state.topRecipePoint?.y);

        setToggleState('logRecastTimeoutsToggle', state.logRecastTimeouts);
        setToggleState('logPeriodicStatsToggle', state.logPeriodicStats);
        setToggleState('logGeneralUpdatesToggle', state.logGeneralUpdates);
        setInputValue('periodicStatsInterval', state.periodicStatsInterval || 5);

        checkRequirements('autoStoreFruit');
        checkRequirements('autoBuyBait');
        checkRequirements('autoCraftBait');
        checkRequirements('autoSelectBait');

      } catch (error) {
        console.error('Failed to poll state:', error);
      }
    }

    function startPolling() {
      if (pollInterval) clearInterval(pollInterval);
      pollInterval = setInterval(pollPythonState, 500);
    }

    window.addEventListener('DOMContentLoaded', () => {
      checkForUpdates();
      checkDisclaimer();
      buildSlideshow();
      loadInitialSettings();

      setTimeout(() => {
        const container = document.getElementById('devilFruitSlotSelector');
        if (container && container.children.length === 0) {
          renderDevilFruitSlotSelector(window.currentDevilFruitSlots || ['3']);
        }
      }, 500);

      startPolling();

      document.querySelectorAll('.nav-item').forEach(nav => {
        nav.addEventListener('click', () => {
          document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
          document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
          nav.classList.add('active');
          document.getElementById(nav.dataset.view).classList.add('active');
          setTimeout(() => lucide.createIcons(), 100);
        });
      });

      lucide.createIcons();
    });

    window.updateStatus = updateStatus;
    window.updateHotkey = updateHotkey;
    window.updatePointStatus = updatePointStatus;
  </script>
</body>

</html>