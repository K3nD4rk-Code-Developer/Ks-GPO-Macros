<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GPO Fishing Macro</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #0d0d0f;
      color: #e5e7eb;
      overflow: hidden;
      height: 100vh;
    }

    .container {
      height: 100vh;
      display: grid;
      grid-template-rows: auto 1fr;
      background: radial-gradient(ellipse at top left, rgba(0, 212, 255, 0.08) 0%, transparent 50%),
        radial-gradient(ellipse at bottom right, rgba(0, 153, 255, 0.06) 0%, transparent 50%),
        #0d0d0f;
      position: relative;
    }

    .container::before {
      content: '';
      position: absolute;
      inset: 0;
      background:
        linear-gradient(90deg, rgba(0, 212, 255, 0.03) 1px, transparent 1px),
        linear-gradient(rgba(0, 212, 255, 0.03) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
      opacity: 0.3;
    }

    .header {
      background: linear-gradient(135deg, rgba(17, 24, 39, 0.7) 0%, rgba(31, 41, 55, 0.5) 100%);
      padding: 24px 32px;
      border-bottom: 1px solid rgba(0, 212, 255, 0.15);
      backdrop-filter: blur(20px);
      position: relative;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.5) 50%, transparent);
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .logo {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #0099ff 0%, rgba(20, 32, 48, 0.5) 100%);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 900;
      font-size: 20px;
      color: white;
      box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4);
    }

    .title-group h1 {
      font-size: 20px;
      font-weight: 800;
      background: linear-gradient(135deg, #fff 0%, #d1d5db 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: -0.5px;
    }

    .version {
      font-size: 11px;
      font-weight: 600;
      color: #00d4ff;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-top: 2px;
    }

    .status-badge {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 16px;
      background: rgba(17, 24, 39, 0.6);
      border-radius: 20px;
      border: 1px solid rgba(0, 212, 255, 0.2);
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #ef4444;
      box-shadow: 0 0 12px rgba(239, 68, 68, 0.8);
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    .status-dot.active {
      background: #10b981;
      box-shadow: 0 0 12px rgba(16, 185, 129, 0.8);
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.5;
      }
    }

    .status-text {
      font-size: 13px;
      font-weight: 600;
      color: #9ca3af;
    }

    .main-content {
      display: grid;
      grid-template-columns: 200px 1fr;
      height: 100%;
      min-height: 0;
      overflow: hidden;
      position: relative;
      z-index: 1;
    }

    .sidebar {
      background: linear-gradient(180deg, rgba(17, 24, 39, 0.4) 0%, rgba(31, 41, 55, 0.3) 100%);
      border-right: 1px solid rgba(0, 212, 255, 0.1);
      padding: 24px 0;
      overflow-y: auto;
      overflow-x: hidden;
      backdrop-filter: blur(10px);
      min-height: 0;
    }

    .sidebar::-webkit-scrollbar {
      width: 4px;
    }

    .sidebar::-webkit-scrollbar-track {
      background: transparent;
    }

    .sidebar::-webkit-scrollbar-thumb {
      background: rgba(0, 212, 255, 0.3);
      border-radius: 2px;
    }

    .sidebar::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 212, 255, 0.5);
    }

    .nav-item {
      padding: 12px 24px;
      margin: 0 12px 6px 12px;
      cursor: pointer;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      color: #9ca3af;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid transparent;
      position: relative;
    }

    .nav-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 3px;
      height: 0;
      background: linear-gradient(180deg, #00d4ff, #0099ff);
      border-radius: 0 2px 2px 0;
      transition: height 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .nav-item:hover {
      color: #e5e7eb;
      background: rgba(0, 212, 255, 0.05);
    }

    .nav-item.active {
      color: #fff;
      background: linear-gradient(135deg, rgba(0, 212, 255, 0.15), rgba(0, 153, 255, 0.1));
      border-color: rgba(0, 212, 255, 0.3);
    }

    .nav-item.active::before {
      height: 20px;
    }

    .content-area {
      overflow-y: auto;
      overflow-x: hidden;
      padding: 32px;
      min-height: 0;
    }

    .content-area::-webkit-scrollbar {
      width: 6px;
    }

    .content-area::-webkit-scrollbar-track {
      background: transparent;
    }

    .content-area::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, rgba(0, 212, 255, 0.4), rgba(0, 153, 255, 0.4));
      border-radius: 3px;
    }

    .content-area::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, rgba(0, 212, 255, 0.6), rgba(0, 153, 255, 0.6));
    }

    .view {
      display: none;
      animation: fadeIn 0.4s ease-out;
    }

    .view.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(100px);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes slideOutRight {
      from {
        opacity: 1;
        transform: translateX(0);
      }

      to {
        opacity: 0;
        transform: translateX(100px);
      }
    }

    .card {
      background: linear-gradient(135deg, rgba(31, 41, 55, 0.4) 0%, rgba(17, 24, 39, 0.5) 100%);
      border: 1px solid rgba(0, 212, 255, 0.15);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }

    .card:hover {
      border-color: rgba(0, 212, 255, 0.3);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .card-header {
      font-size: 15px;
      font-weight: 700;
      color: #f9fafb;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(0, 212, 255, 0.1);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .control-group {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 0;
      border-bottom: 1px solid rgba(75, 85, 99, 0.1);
    }

    .control-group:last-child {
      border-bottom: none;
    }

    .control-label {
      font-size: 13px;
      font-weight: 500;
      color: #d1d5db;
      flex: 1;
    }

    .control-input {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .input {
      padding: 8px 14px;
      background: rgba(17, 24, 39, 0.8);
      border: 1px solid rgba(0, 212, 255, 0.2);
      border-radius: 8px;
      font-size: 13px;
      color: #e5e7eb;
      width: 90px;
      transition: all 0.3s;
      font-weight: 500;
    }

    .input:focus {
      outline: none;
      border-color: #00d4ff;
      box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
      background: rgba(17, 24, 39, 0.95);
    }

    .select {
      padding: 8px 14px;
      background: rgba(17, 24, 39, 0.8);
      border: 1px solid rgba(0, 212, 255, 0.2);
      border-radius: 8px;
      font-size: 13px;
      color: #e5e7eb;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
    }

    .select:focus {
      outline: none;
      border-color: #00d4ff;
      box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
    }

    .hotkey-badge {
      padding: 8px 18px;
      background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(0, 153, 255, 0.15));
      border: 1px solid rgba(0, 212, 255, 0.4);
      border-radius: 8px;
      font-weight: 700;
      color: #c7d2fe;
      text-transform: uppercase;
      font-size: 12px;
      letter-spacing: 1px;
      box-shadow: 0 4px 12px rgba(0, 212, 255, 0.15);
    }

    .btn {
      padding: 8px 20px;
      background: linear-gradient(135deg, #00d4ff66 0%, #0099ff 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 12px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px #00d4ff66;
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-secondary {
      background: linear-gradient(135deg, rgba(75, 85, 99, 0.5), rgba(55, 65, 81, 0.6));
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .btn-secondary:hover {
      background: linear-gradient(135deg, rgba(85, 95, 109, 0.6), rgba(65, 75, 91, 0.7));
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    .btn-sm {
      padding: 6px 16px;
      font-size: 11px;
    }

    .toggle-switch {
      position: relative;
      width: 48px;
      height: 24px;
      background: rgba(75, 85, 99, 0.5);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      border: 1px solid rgba(99, 102, 241, 0.2);
    }

    .toggle-switch.active {
      background: linear-gradient(135deg, #00d4ff, #0099ff);
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 18px;
      height: 18px;
      background: white;
      border-radius: 50%;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .toggle-switch.active::after {
      transform: translateX(24px);
    }

    .point-indicator {
      padding: 6px 14px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      white-space: nowrap;
    }

    .point-indicator.set {
      background: rgba(16, 185, 129, 0.1);
      color: #34d399;
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .point-indicator.unset {
      background: rgba(239, 68, 68, 0.1);
      color: #f87171;
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .expandable-section {
      margin-top: 16px;
      padding-left: 16px;
      border-left: 2px solid rgba(0, 212, 255, 0.3);
      display: none;
    }

    .expandable-section.expanded {
      display: block;
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        max-height: 0;
      }

      to {
        opacity: 1;
        max-height: 1000px;
      }
    }

    .unit {
      font-size: 12px;
      color: #6b7280;
      font-weight: 500;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .help-hint {
      font-size: 11px;
      color: #6b7280;
      margin-top: 8px;
      font-style: italic;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <div class="brand">
        <div class="logo">K</div>
        <div class="title-group">
          <h1>GPO Fishing Macro</h1>
          <div class="version">Version 1.2.4</div>
        </div>
      </div>
      <div class="status-badge">
        <div class="status-dot" id="statusDot"></div>
        <span class="status-text" id="statusText">Inactive</span>
      </div>
    </div>

    <div class="main-content">
      <div class="sidebar">
        <div class="nav-item active" data-view="controls">Control Center</div>
        <div class="nav-item" data-view="locations">Locations</div>
        <div class="nav-item" data-view="automation">Automation</div>
        <div class="nav-item" data-view="logging">Logging</div>
        <div class="nav-item" data-view="tuning">Tuning</div>
        <div class="nav-item" data-view="timing">Timing</div>
      </div>

      <div class="content-area">
        <div class="view active" id="controls">
          <div class="card">
            <div class="card-header">Keybinds</div>
            <div class="control-group">
              <span class="control-label">Start/Stop Macro</span>
              <div class="control-input">
                <div class="hotkey-badge" id="hotkey-start">F1</div>
                <button class="btn btn-sm" onclick="sendToPython('rebind_hotkey', 'start_stop')">Rebind</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Exit Application</span>
              <div class="control-input">
                <div class="hotkey-badge" id="hotkey-exit">F3</div>
                <button class="btn btn-sm" onclick="sendToPython('rebind_hotkey', 'exit')">Rebind</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Configure Scan Area</span>
              <div class="control-input">
                <button class="btn btn-sm" onclick="sendToPython('open_area_selector', '')">Open Area Selector</button>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Inventory Slots</div>
            <div class="control-group">
              <span class="control-label">Fishing Rod Slot</span>
              <div class="control-input">
                <select class="select" id="rodHotkey" onchange="sendToPython('set_rod_hotkey', this.value)">
                  <option selected>1</option>
                  <option>2</option>
                  <option>3</option>
                  <option>4</option>
                  <option>5</option>
                  <option>6</option>
                  <option>7</option>
                  <option>8</option>
                  <option>9</option>
                  <option>0</option>
                </select>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Secondary Item Slot</span>
              <div class="control-input">
                <select class="select" id="anythingElseHotkey"
                  onchange="sendToPython('set_anything_else_hotkey', this.value)">
                  <option>1</option>
                  <option selected>2</option>
                  <option>3</option>
                  <option>4</option>
                  <option>5</option>
                  <option>6</option>
                  <option>7</option>
                  <option>8</option>
                  <option>9</option>
                  <option>0</option>
                </select>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Devil Fruit Slots</span>
              <div class="control-input" style="margin-left: 20px;">
                <div id="devilFruitSlotSelector" style="display: flex; gap: 8px; flex-wrap: wrap;">
                </div>
              </div>
            </div>
            <div class="help-hint">Select multiple slots to check for devil fruits</div>
          </div>

          <div class="card">
            <div class="card-header">Application Settings</div>
            <div class="control-group">
              <span class="control-label">Keep Window on Top</span>
              <div class="control-input">
                <div class="toggle-switch" id="alwaysOnTopToggle" onclick="toggleSetting('alwaysOnTop')"></div>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Display Statistics Overlay</span>
              <div class="control-input">
                <div class="toggle-switch" id="debugOverlayToggle" onclick="toggleSetting('debugOverlay')"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="view" id="locations">
          <div class="card">
            <div class="card-header">Primary Fishing Location</div>
            <div class="control-group">
              <span class="control-label">Water Target Point</span>
              <div class="control-input">
                <span class="point-indicator unset" id="waterPointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_water_point', '')">Configure</button>
              </div>
            </div>
            <div class="help-hint">Click the location in water where you want to cast your fishing line</div>
          </div>

          <div class="card">
            <div class="card-header">Bait Shop Interaction Points</div>
            <div class="control-group">
              <span class="control-label">Left Dialog Option</span>
              <div class="control-input">
                <span class="point-indicator unset" id="leftPointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_left_point', '')">Configure</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Middle Dialog Option</span>
              <div class="control-input">
                <span class="point-indicator unset" id="middlePointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_middle_point', '')">Configure</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Right Dialog Option</span>
              <div class="control-input">
                <span class="point-indicator unset" id="rightPointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_right_point', '')">Configure</button>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              Crafting Interface Points
            </div>
            <div class="control-group">
              <span class="control-label">Left UI</span>
              <div class="control-input">
                <span class="point-indicator unset" id="craftLeftPointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_craft_left_point', '')">Configure</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Middle UI</span>
              <div class="control-input">
                <span class="point-indicator unset" id="craftMiddlePointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_craft_middle_point', '')">Configure</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Craft Confirmation</span>
              <div class="control-input">
                <span class="point-indicator unset" id="craftButtonPointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_craft_button_point', '')">Configure</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Menu Close</span>
              <div class="control-input">
                <span class="point-indicator unset" id="closeMenuPointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_close_menu_point', '')">Configure</button>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              Crafting Recipes
              <button class="btn btn-sm" onclick="AddNewRecipe()" style="float: right;">+ Add Recipe</button>
            </div>
            <div id="RecipesContainer">
            </div>
          </div>

          <div class="card">
            <div class="card-header">Devil Fruit Locations</div>
            <div class="control-group">
              <span class="control-label">Devil Fruit Store</span>
              <div class="control-input">
                <span class="point-indicator unset" id="storeFruitPointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_store_fruit_point', '')">Configure</button>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Devil Fruit Backpack</span>
              <div class="control-input">
                <span class="point-indicator unset" id="devilFruitLocationPointStatus">Not Configured</span>
                <button class="btn btn-sm"
                  onclick="sendToPython('set_devil_fruit_location_point', '')">Configure</button>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Bait Locations</div>
            <div class="control-group">
              <span class="control-label">Top Bait Point</span>
              <div class="control-input">
                <span class="point-indicator unset" id="baitPointStatus">Not Configured</span>
                <button class="btn btn-sm" onclick="sendToPython('set_bait_point', '')">Configure</button>
              </div>
            </div>
          </div>
        </div>

        <div class="view" id="automation">
          <div class="card">
            <div class="card-header">Auto Purchase Bait</div>
            <div class="control-group">
              <span class="control-label">Enable Auto Buy Common Bait</span>
              <div class="control-input">
                <div class="toggle-switch" id="autoBuyBaitToggle"
                  onclick="toggleExpandable('autoBuyBait', 'autoBuyExpand')"></div>
              </div>
            </div>
            <div class="expandable-section" id="autoBuyExpand">
              <div class="control-group">
                <span class="control-label">Purchase Frequency</span>
                <div class="control-input">
                  <input type="number" class="input" id="loopsPerPurchase" value="100" step="1"
                    onchange="sendToPython('set_loops_per_purchase', this.value)">
                  <span class="unit">loops</span>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Auto Craft Bait</div>
            <div class="control-group">
              <span class="control-label">Enable Auto Craft</span>
              <div class="control-input">
                <div class="toggle-switch" id="autoCraftBaitToggle"
                  onclick="toggleExpandable('autoCraftBait', 'autoCraftExpand')"></div>
              </div>
            </div>
            <div class="expandable-section" id="autoCraftExpand">
              <div class="control-group">
                <span class="control-label">Fish Caught Before Craft</span>
                <div class="control-input">
                  <input type="number" class="input" id="fishCountPerCraft" value="50" step="1" min="1"
                    onchange="sendToPython('set_fish_count_per_craft', this.value)">
                  <span class="unit">fish</span>
                </div>
              </div>
              <div class="control-group">
                <span class="control-label">Movement Duration</span>
                <div class="control-input">
                  <input type="number" class="input" id="moveDuration" value="4.25" step="0.25"
                    onchange="sendToPython('set_move_duration', this.value)">
                  <span class="unit">seconds</span>
                </div>
              </div>
              <div class="control-group">
                <span class="control-label">Add Recipe</span>
                <div class="control-input">
                  <span class="point-indicator unset" id="addRecipePointStatus">Not Configured</span>
                  <button class="btn btn-sm" onclick="sendToPython('set_add_recipe_point', '')">Configure</button>
                </div>
              </div>
              <div class="control-group">
                <span class="control-label">Top Recipe Slot</span>
                <div class="control-input">
                  <span class="point-indicator unset" id="topRecipePointStatus">Not Configured</span>
                  <button class="btn btn-sm" onclick="sendToPython('set_top_recipe_point', '')">Configure</button>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Auto Store Devil Fruit</div>
            <div class="control-group">
              <span class="control-label">Enable Auto Storage</span>
              <div class="control-input">
                <div class="toggle-switch" id="autoStoreFruitToggle"
                  onclick="toggleExpandable('autoStoreFruit', 'autoStoreExpand')"></div>
              </div>
            </div>
            <div class="expandable-section" id="autoStoreExpand">
              <div class="control-group">
                <span class="control-label">Store to Backpack (vs Drop)</span>
                <div class="control-input">
                  <div class="toggle-switch" id="storeToBackpackToggle" onclick="toggleSetting('storeToBackpack')">
                  </div>
                </div>
              </div>
              <div class="control-group">
                <span class="control-label">Storage Frequency</span>
                <div class="control-input">
                  <input type="number" class="input" id="loopsPerStore" value="1" step="1" min="1"
                    onchange="sendToPython('set_loops_per_store', this.value)">
                  <span class="unit">loops</span>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Auto Select Bait</div>
            <div class="control-group">
              <span class="control-label">Enable Auto Select Top Bait</span>
              <div class="control-input">
                <div class="toggle-switch" id="autoSelectBaitToggle" onclick="toggleSetting('autoSelectBait')"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="view" id="logging">
          <div class="card">
            <div class="card-header">Webhook Configuration</div>
            <div class="control-group">
              <span class="control-label">Discord Webhook URL</span>
              <div class="control-input">
                <input type="text" class="input input-wide" id="webhookUrl"
                  placeholder="https://discord.com/api/webhooks/..."
                  onchange="sendToPython('set_webhook_url', this.value)">
              </div>
            </div>
            <div class="help-hint">Paste your Discord webhook URL to receive notifications</div>
          </div>

          <div class="card">
            <div class="card-header">Event Logging</div>
            <div class="checkbox-group">
              <div class="checkbox-item">
                <input type="checkbox" id="logDevilFruit"
                  onchange="sendToPython('toggle_log_devil_fruit', this.checked.toString())">
                <label class="checkbox-label" for="logDevilFruit">
                  Devil Fruit Stored
                </label>
              </div>
            </div>
            <div class="help-hint">Select which events to send to your webhook</div>
          </div>
        </div>

        <div class="view" id="tuning">
          <div class="card">
            <div class="card-header">PD Controller Settings</div>
            <div class="control-group">
              <span class="control-label">Proportional Gain (Follow Strength)</span>
              <div class="control-input">
                <input type="number" class="input" id="kp" value="0.9" step="0.1"
                  onchange="sendToPython('set_kp', this.value)">
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Derivative Gain (Damping)</span>
              <div class="control-input">
                <input type="number" class="input" id="kd" value="0.3" step="0.1"
                  onchange="sendToPython('set_kd', this.value)">
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Maximum Correction Clamp</span>
              <div class="control-input">
                <input type="number" class="input" id="pdClamp" value="1.0" step="0.1"
                  onchange="sendToPython('set_pd_clamp', this.value)">
              </div>
            </div>
            <div class="help-hint">PD control maintains alignment between the fishing bar and target</div>
          </div>

          <div class="card">
            <div class="card-header">Advanced PD Parameters</div>
            <div class="control-group">
              <span class="control-label">Approaching Damping Factor</span>
              <div class="control-input">
                <input type="number" class="input" id="pdApproaching" value="2.0" step="0.1"
                  onchange="sendToPython('set_pd_approaching', this.value)">
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Chasing Damping Factor</span>
              <div class="control-input">
                <input type="number" class="input" id="pdChasing" value="0.5" step="0.1"
                  onchange="sendToPython('set_pd_chasing', this.value)">
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Gap Tolerance Multiplier</span>
              <div class="control-input">
                <input type="number" class="input" id="gapTolerance" value="2.0" step="0.1"
                  onchange="sendToPython('set_gap_tolerance', this.value)">
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Casting Configuration</div>
            <div class="control-group">
              <span class="control-label">Cast Hold Duration</span>
              <div class="control-input">
                <input type="number" class="input" id="castHold" value="1.0" step="0.1"
                  onchange="sendToPython('set_cast_hold', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Recast Timeout</span>
              <div class="control-input">
                <input type="number" class="input" id="recastTimeout" value="30.0" step="1.0"
                  onchange="sendToPython('set_recast_timeout', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Anti-Detection Thresholds</div>
            <div class="control-group">
              <span class="control-label">Black Screen Detection</span>
              <div class="control-input">
                <input type="number" class="input" id="blackThreshold" value="0.5" step="0.05"
                  onchange="sendToPython('set_black_threshold', this.value)">
                <span class="unit">%</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Key Spam Prevention Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="spamDelay" value="0.25" step="0.05"
                  onchange="sendToPython('set_spam_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
          </div>
        </div>

        <div class="view" id="timing">
          <div class="card">
            <div class="card-header">Core Timing Settings</div>
            <div class="control-group">
              <span class="control-label">Fish Completion Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="fishEndDelay" value="2.0" step="0.1"
                  onchange="sendToPython('set_fish_end_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">State Resend Interval</span>
              <div class="control-input">
                <input type="number" class="input" id="stateResend" value="0.5" step="0.05"
                  onchange="sendToPython('set_state_resend', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Scan Loop Frequency</span>
              <div class="control-input">
                <input type="number" class="input" id="scanDelay" value="0.1" step="0.01"
                  onchange="sendToPython('set_scan_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Window Focus Timing</div>
            <div class="control-group">
              <span class="control-label">Initial Focus Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="focusDelay" value="0.2" step="0.1"
                  onchange="sendToPython('set_focus_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Post-Focus Stabilization</span>
              <div class="control-input">
                <input type="number" class="input" id="postFocusDelay" value="1.0" step="0.1"
                  onchange="sendToPython('set_post_focus_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Purchase Interaction Timing</div>
            <div class="control-group">
              <span class="control-label">Interaction Key Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="preCastE" value="3.0" step="0.1"
                  onchange="sendToPython('set_precast_e_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Click Confirmation Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="preCastClick" value="3.0" step="0.1"
                  onchange="sendToPython('set_precast_click_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Typing Input Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="preCastType" value="3.0" step="0.1"
                  onchange="sendToPython('set_precast_type_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Humanization Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="antiDetect" value="0.05" step="0.01"
                  onchange="sendToPython('set_anti_detect_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Inventory Selection Timing</div>
            <div class="control-group">
              <span class="control-label">Rod Selection Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="rodDelay" value="0.5" step="0.1"
                  onchange="sendToPython('set_rod_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Bait Selection Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="baitDelay" value="0.5" step="0.1"
                  onchange="sendToPython('set_bait_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Cursor Movement Humanization</span>
              <div class="control-input">
                <input type="number" class="input" id="cursorDelay" value="0.05" step="0.01"
                  onchange="sendToPython('set_cursor_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Devil Fruit Storage Timing</div>
            <div class="control-group">
              <span class="control-label">Hotkey Press Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="fruitHotkey" value="1.0" step="0.1"
                  onchange="sendToPython('set_fruit_hotkey_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Click Interaction Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="fruitClick" value="2.0" step="0.1"
                  onchange="sendToPython('set_fruit_click_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Shift Key Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="fruitShift" value="0.5" step="0.1"
                  onchange="sendToPython('set_fruit_shift_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
            <div class="control-group">
              <span class="control-label">Backspace Input Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="fruitBackspace" value="1.5" step="0.1"
                  onchange="sendToPython('set_fruit_backspace_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">Crafting Timing</div>

            <div class="control-group">
              <span class="control-label">Menu Open Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="craftMenuDelay" value="0.85" step="0.05"
                  onchange="sendToPython('set_craft_menu_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>

            <div class="control-group">
              <span class="control-label">UI Click Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="craftClickDelay" value="0.5" step="0.05"
                  onchange="sendToPython('set_craft_click_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>

            <div class="control-group">
              <span class="control-label">Recipe Selection Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="craftRecipeDelay" value="0.5" step="0.05"
                  onchange="sendToPython('set_craft_recipe_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>

            <div class="control-group">
              <span class="control-label">Add Recipe Button Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="craftAddDelay" value="0.5" step="0.05"
                  onchange="sendToPython('set_craft_add_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>

            <div class="control-group">
              <span class="control-label">Top Recipe Slot Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="craftTopDelay" value="0.5" step="0.05"
                  onchange="sendToPython('set_craft_top_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>

            <div class="control-group">
              <span class="control-label">Craft Button Click Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="craftButtonDelay" value="0.025" step="0.005"
                  onchange="sendToPython('set_craft_button_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>

            <div class="control-group">
              <span class="control-label">Close Menu Delay</span>
              <div class="control-input">
                <input type="number" class="input" id="craftCloseDelay" value="0.5" step="0.05"
                  onchange="sendToPython('set_craft_close_delay', this.value)">
                <span class="unit">seconds</span>
              </div>
            </div>

            <div class="help-hint">Fine-tune delays between crafting actions to prevent errors</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>

  <script>
    document.querySelectorAll('.nav-item').forEach(nav => {
      nav.addEventListener('click', () => {
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));

        nav.classList.add('active');
        document.getElementById(nav.dataset.view).classList.add('active');
      });
    });

    function toggleSetting(settingName) {
      const toggle = document.getElementById(`${settingName}Toggle`);
      toggle.classList.toggle('active');
      const isActive = toggle.classList.contains('active');
      sendToPython(`toggle_${settingName.replace(/([A-Z])/g, '_$1').toLowerCase()}`, isActive.toString());
    }

    function renderDevilFruitSlotSelector(selectedSlots) {
        const container = document.getElementById('devilFruitSlotSelector');
        if (!container) return;

        container.innerHTML = '';

        for (let i = 0; i <= 9; i++) {
          const button = document.createElement('button');
          button.className = 'btn btn-sm slot-button';
          button.textContent = i.toString();

          const isSelected = selectedSlots && selectedSlots.includes(i.toString());

          if (isSelected) {
            button.style.cssText = `
        min-width: 36px; 
        padding: 6px 10px;
        background: linear-gradient(135deg, #00d4ff, #0099ff);
        border-color: #00d4ff;
        box-shadow: 0 4px 12px rgba(0, 212, 255, 0.4);
      `;
          } else {
            button.style.cssText = `
        min-width: 36px; 
        padding: 6px 10px;
        background: linear-gradient(135deg, rgba(75, 85, 99, 0.5), rgba(55, 65, 81, 0.6));
        box-shadow: none;
      `;
          }

          button.onclick = () => toggleDevilFruitSlot(i.toString());
          container.appendChild(button);
        }
      }

      function toggleDevilFruitSlot(slot) {
        let currentSlots = window.currentDevilFruitSlots || ['3'];

        if (currentSlots.includes(slot)) {
          currentSlots = currentSlots.filter(s => s !== slot);
        } else {
          currentSlots.push(slot);
        }

        if (currentSlots.length === 0) {
          currentSlots = ['3'];
        }

        window.currentDevilFruitSlots = currentSlots;
        renderDevilFruitSlotSelector(currentSlots);

        sendToPython('set_devil_fruit_hotkeys', currentSlots.join(','));
      }

    function toggleExpandable(settingName, expandId) {
      const toggle = document.getElementById(`${settingName}Toggle`);
      const section = document.getElementById(expandId);
      toggle.classList.toggle('active');
      const isActive = toggle.classList.contains('active');

      if (isActive) {
        section.classList.add('expanded');
      } else {
        section.classList.remove('expanded');
      }

      sendToPython(`toggle_${settingName.replace(/([A-Z])/g, '_$1').toLowerCase()}`, isActive.toString());
    }

    async function sendToPython(action, payload) {
      try {
        console.log('Sending to Python:', action, payload);
        const response = await fetch('http://localhost:8765/command', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action, payload })
        });

        const result = await response.json();

        if (result.status === 'error') {
          showErrorNotification(`Error: ${result.message}`);
        }
      } catch (error) {
        console.error('Failed to send to Python:', error);
        showErrorNotification(`Connection failed: ${error.message}`);
      }
    }

    function showErrorNotification(message) {
      const notification = document.createElement('div');
      notification.style.cssText = `
    position: fixed;
    top: 80px;
    right: 20px;
    background: linear-gradient(135deg, rgba(239, 68, 68, 0.95), rgba(220, 38, 38, 0.95));
    color: white;
    padding: 16px 24px;
    border-radius: 12px;
    font-weight: 600;
    font-size: 14px;
    box-shadow: 0 8px 32px rgba(239, 68, 68, 0.4);
    z-index: 10000;
    animation: slideInRight 0.3s ease-out;
    border: 1px solid rgba(255, 255, 255, 0.2);
    max-width: 400px;
    word-wrap: break-word;
  `;
      notification.textContent = message;
      document.body.appendChild(notification);

      setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.3s ease-out';
        setTimeout(() => notification.remove(), 300);
      }, 5000);
    }

    function updateStatus(isRunning) {
      const dot = document.getElementById('statusDot');
      const text = document.getElementById('statusText');

      if (isRunning) {
        dot.classList.add('active');
        text.textContent = 'Active';
      } else {
        dot.classList.remove('active');
        text.textContent = 'Inactive';
      }
    }

    function updateHotkey(key, value) {
      const element = document.getElementById(`hotkey-${key}`);
      if (element) {
        element.textContent = value.toUpperCase();
      }
    }

    function updatePointStatus(pointName, x, y) {
      const status = document.getElementById(`${pointName}Status`);
      if (!status) {
        console.warn(`Point status element not found: ${pointName}Status`);
        return;
      }

      if (x !== null && y !== null && x !== undefined && y !== undefined) {
        status.textContent = `X: ${x}, Y: ${y}`;
        status.classList.remove('unset');
        status.classList.add('set');
      } else {
        status.textContent = 'Not Configured';
        status.classList.remove('set');
        status.classList.add('unset');
      }
    }

    function setInputValue(elementId, value) {
      const element = document.getElementById(elementId);
      if (!element) {
        console.warn(`Element not found: ${elementId}`);
        return;
      }

      if (element.type === 'number' || element.tagName === 'INPUT') {
        element.value = value;
      } else if (element.tagName === 'SELECT') {
        element.value = value;
      }
    }

    function setToggleState(elementId, isActive) {
      const element = document.getElementById(elementId);
      if (!element) {
        console.warn(`Toggle element not found: ${elementId}`);
        return;
      }

      if (isActive) {
        element.classList.add('active');
      } else {
        element.classList.remove('active');
      }
    }

    function setExpandableSection(toggleId, expandId, isActive) {
      const toggle = document.getElementById(toggleId);
      const section = document.getElementById(expandId);

      if (!toggle || !section) {
        console.warn(`Expandable section not found: ${toggleId} or ${expandId}`);
        return;
      }

      if (isActive) {
        toggle.classList.add('active');
        section.classList.add('expanded');
      } else {
        toggle.classList.remove('active');
        section.classList.remove('expanded');
      }
    }

    async function AddNewRecipe() {
      try {
        const Response = await fetch('http://localhost:8765/add_recipe', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        });
        const Result = await Response.json();
        if (Result.status === 'success') {
          await pollPythonState();
        }
      } catch (Error) {
        console.error('Failed to add recipe:', Error);
      }
    }

    async function RemoveRecipe(RecipeIndex) {
      try {
        const Response = await fetch('http://localhost:8765/remove_recipe', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ index: RecipeIndex })
        });
        await pollPythonState();
      } catch (Error) {
        console.error('Failed to remove recipe:', Error);
      }
    }

    async function SetRecipePoint(RecipeIndex, PointType) {
      try {
        const Response = await fetch('http://localhost:8765/set_recipe_point', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ recipeIndex: RecipeIndex, pointType: PointType })
        });
      } catch (Error) {
        console.error('Failed to set recipe point:', Error);
      }
    }

    let LastRenderedRecipes = null;

    function RenderRecipes(Recipes) {
      const Container = document.getElementById('RecipesContainer');
      if (!Container) return;

      if (JSON.stringify(Recipes) === JSON.stringify(LastRenderedRecipes)) {
        return;
      }

      LastRenderedRecipes = JSON.parse(JSON.stringify(Recipes));

      Container.innerHTML = '';

      if (Recipes.length === 0) {
        Container.innerHTML = '<div style="text-align: center; padding: 20px; color: #6b7280;">No recipes configured. Click "+ Add Recipe" to get started.</div>';
        return;
      }

      Recipes.forEach((Recipe, Index) => {
        const RecipeDiv = document.createElement('div');
        RecipeDiv.className = 'recipe-item';
        RecipeDiv.style.cssText = `
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            background: rgba(17, 24, 39, 0.3);
        `;

        RecipeDiv.innerHTML = `
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <strong style="color: #00d4ff;">Recipe ${Index + 1}</strong>
              <button class="btn btn-sm btn-secondary" onclick="RemoveRecipe(${Index})">Remove</button>
          </div>
          
          <div class="control-group">
              <span class="control-label">Bait Recipe Selection</span>
              <div class="control-input">
                  <span class="point-indicator ${Recipe.BaitRecipePoint ? 'set' : 'unset'}">
                      ${Recipe.BaitRecipePoint ? `X: ${Recipe.BaitRecipePoint.x}, Y: ${Recipe.BaitRecipePoint.y}` : 'Not Configured'}
                  </span>
                  <button class="btn btn-sm" onclick="SetRecipePoint(${Index}, 'BaitRecipePoint')">Configure</button>
              </div>
          </div>
          
          <div class="control-group">
              <span class="control-label">Amount of Crafts</span>
              <div class="control-input">
                  <input type="number" class="input" value="${Recipe.CraftsPerCycle || 40}" step="1"
                      onchange="UpdateRecipeValue(${Index}, 'CraftsPerCycle', this.value)">
              </div>
          </div>
          
          <div class="control-group">
              <span class="control-label">Switch Fish Cycle</span>
              <div class="control-input">
                  <input type="number" class="input" value="${Recipe.SwitchFishCycle || 5}" step="1"
                      onchange="UpdateRecipeValue(${Index}, 'SwitchFishCycle', this.value)">
              </div>
          </div>
      `;

        Container.appendChild(RecipeDiv);
      });
    }

    async function UpdateRecipeValue(RecipeIndex, FieldName, Value) {
      try {
        const Response = await fetch('http://localhost:8765/update_recipe_value', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            recipeIndex: RecipeIndex,
            fieldName: FieldName,
            value: parseInt(Value)
          })
        });
      } catch (Error) {
        console.error('Failed to update recipe value:', Error);
      }
    }

    function loadAllSettings(state) {
      console.log('Loading all settings from state:', state);

      if (state.hotkeys) {
        updateHotkey('start', state.hotkeys.start_stop || 'f1');
        updateHotkey('area', state.hotkeys.change_area || 'f2');
        updateHotkey('exit', state.hotkeys.exit || 'f3');
      }

      setInputValue('rodHotkey', state.rodHotkey || '1');
      setInputValue('anythingElseHotkey', state.anythingElseHotkey || '2');
      let dfSlots = state.devilFruitHotkeys || state.devilFruitHotkey || ['3'];
      if (!Array.isArray(dfSlots)) {
        dfSlots = [dfSlots];
      }
      window.currentDevilFruitSlots = dfSlots;
      renderDevilFruitSlotSelector(dfSlots);

      setToggleState('alwaysOnTopToggle', state.alwaysOnTop);
      setToggleState('debugOverlayToggle', state.showDebugOverlay);

      setExpandableSection('autoBuyBaitToggle', 'autoBuyExpand', state.autoBuyCommonBait);
      setExpandableSection('autoCraftBaitToggle', 'autoCraftExpand', state.autoCraftBait);
      setExpandableSection('autoStoreFruitToggle', 'autoStoreExpand', state.autoStoreDevilFruit);
      setToggleState('autoSelectBaitToggle', state.autoSelectTopBait);
      setToggleState('storeToBackpackToggle', state.storeToBackpack);

      setInputValue('kp', state.kp);
      setInputValue('kd', state.kd);
      setInputValue('pdClamp', state.pdClamp);
      setInputValue('pdApproaching', state.pdApproachingDamping);
      setInputValue('pdChasing', state.pdChasingDamping);
      setInputValue('gapTolerance', state.gapToleranceMultiplier);

      setInputValue('castHold', state.castHoldDuration);
      setInputValue('recastTimeout', state.recastTimeout);
      setInputValue('fishEndDelay', state.fishEndDelay);
      setInputValue('stateResend', state.stateResendInterval);
      setInputValue('loopsPerPurchase', state.loopsPerPurchase);
      setInputValue('loopsPerStore', state.loopsPerStore);
      setInputValue('craftsPerCycle', state.craftsPerCycle);
      setInputValue('loopsPerCraft', state.loopsPerCraft);
      setInputValue('moveDuration', state.moveDuration);
      setInputValue('fishCountPerCraft', state.fishCountPerCraft);

      setInputValue('focusDelay', state.robloxFocusDelay);
      setInputValue('postFocusDelay', state.robloxPostFocusDelay);

      setInputValue('preCastE', state.preCastEDelay);
      setInputValue('preCastClick', state.preCastClickDelay);
      setInputValue('preCastType', state.preCastTypeDelay);
      setInputValue('antiDetect', state.preCastAntiDetectDelay);

      setInputValue('fruitHotkey', state.storeFruitHotkeyDelay);
      setInputValue('fruitClick', state.storeFruitClickDelay);
      setInputValue('fruitShift', state.storeFruitShiftDelay);
      setInputValue('fruitBackspace', state.storeFruitBackspaceDelay);

      setInputValue('rodDelay', state.rodSelectDelay);
      setInputValue('baitDelay', state.autoSelectBaitDelay);
      setInputValue('cursorDelay', state.cursorAntiDetectDelay);
      setInputValue('scanDelay', state.scanLoopDelay);

      setInputValue('blackThreshold', state.blackScreenThreshold);
      setInputValue('spamDelay', state.antiMacroSpamDelay);

      setInputValue('craftMenuDelay', state.craftMenuOpenDelay);
      setInputValue('craftClickDelay', state.craftClickDelay);
      setInputValue('craftRecipeDelay', state.craftRecipeSelectDelay);

      updatePointStatus('waterPoint', state.waterPoint?.x, state.waterPoint?.y);
      updatePointStatus('leftPoint', state.leftPoint?.x, state.leftPoint?.y);
      updatePointStatus('middlePoint', state.middlePoint?.x, state.middlePoint?.y);
      updatePointStatus('rightPoint', state.rightPoint?.x, state.rightPoint?.y);
      updatePointStatus('storeFruitPoint', state.storeFruitPoint?.x, state.storeFruitPoint?.y);
      updatePointStatus('baitPoint', state.baitPoint?.x, state.baitPoint?.y);
      updatePointStatus('craftLeftPoint', state.craftLeftPoint?.x, state.craftLeftPoint?.y);
      updatePointStatus('craftMiddlePoint', state.craftMiddlePoint?.x, state.craftMiddlePoint?.y);
      updatePointStatus('baitRecipePoint', state.baitRecipePoint?.x, state.baitRecipePoint?.y);
      updatePointStatus('addRecipePoint', state.addRecipePoint?.x, state.addRecipePoint?.y);
      updatePointStatus('topRecipePoint', state.topRecipePoint?.x, state.topRecipePoint?.y);
      updatePointStatus('craftButtonPoint', state.craftButtonPoint?.x, state.craftButtonPoint?.y);
      updatePointStatus('closeMenuPoint', state.closeMenuPoint?.x, state.closeMenuPoint?.y);
      updatePointStatus('devilFruitLocationPoint', state.devilFruitLocationPoint?.x, state.devilFruitLocationPoint?.y);

      setInputValue('webhookUrl', state.webhookUrl || '');
      document.getElementById('logDevilFruit').checked = state.logDevilFruit || false;

      console.log('All settings loaded successfully');
    }

    async function pollPythonState() {
      try {
        const response = await fetch('http://localhost:8765/state');
        const state = await response.json();

        updateStatus(state.isRunning);

        if (state.baitRecipes !== undefined) {
          RenderRecipes(state.baitRecipes);
        }

        updatePointStatus('waterPoint', state.waterPoint?.x, state.waterPoint?.y);
        updatePointStatus('leftPoint', state.leftPoint?.x, state.leftPoint?.y);
        updatePointStatus('middlePoint', state.middlePoint?.x, state.middlePoint?.y);
        updatePointStatus('rightPoint', state.rightPoint?.x, state.rightPoint?.y);
        updatePointStatus('storeFruitPoint', state.storeFruitPoint?.x, state.storeFruitPoint?.y);
        updatePointStatus('baitPoint', state.baitPoint?.x, state.baitPoint?.y);
        updatePointStatus('craftLeftPoint', state.craftLeftPoint?.x, state.craftLeftPoint?.y);
        updatePointStatus('craftMiddlePoint', state.craftMiddlePoint?.x, state.craftMiddlePoint?.y);
        updatePointStatus('craftButtonPoint', state.craftButtonPoint?.x, state.craftButtonPoint?.y);
        updatePointStatus('closeMenuPoint', state.closeMenuPoint?.x, state.closeMenuPoint?.y);
        updatePointStatus('devilFruitLocationPoint', state.devilFruitLocationPoint?.x, state.devilFruitLocationPoint?.y);
      } catch (error) {
        console.error('Failed to poll state:', error);
      }
    }

    async function loadInitialSettings() {
      try {
        const response = await fetch('http://localhost:8765/state');
        const state = await response.json();
        console.log('Loaded initial state:', state);
        loadAllSettings(state);
      } catch (error) {
        console.error('Failed to load initial settings:', error);
      }
    }

    let pollInterval;
    function startPolling() {
      if (pollInterval) clearInterval(pollInterval);
      pollInterval = setInterval(pollPythonState, 500);
    }

    window.addEventListener('DOMContentLoaded', () => {
      console.log('DOM loaded, initializing...');
      loadInitialSettings();
      startPolling();
    });

    window.updateStatus = updateStatus;
    window.updateHotkey = updateHotkey;
    window.updatePointStatus = updatePointStatus;
  </script>
</body>

</html>